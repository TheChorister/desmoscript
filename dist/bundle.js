/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{compileDesmoscript:()=>Go,compileDesmoscriptForLanguageSupport:()=>ri,enableDebug:()=>n,formatError:()=>Pe,getLinesAndCols:()=>ii,lex:()=>l,parse:()=>P,placeholder:()=>oi,typecheckScopeTree:()=>Tt});var r=!1;function n(){r=!0}function o(){var e;r&&(e=console).log.apply(e,arguments)}function i(){r&&console.trace()}function a(e,t,r,n){return{reason:e,start:t,end:r,type:"general",unit:n}}function s(e){return{reason:e,internal:!0}}function c(e,t){if(null==e)throw i(),s(null!=t?t:"unexpected undefined");return e}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r){for(var n,o,i=(n=e,o=0,{done:function(){return o>=n.length},pos:function(){return o},match:function(e,t){if(Array.isArray(e)){var r,i=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(n.slice(o).startsWith(a))return t||(o+=a.length),a}}catch(e){i.e(e)}finally{i.f()}}else if(e instanceof RegExp){var s,c=null===(s=n.slice(o).match(e))||void 0===s?void 0:s[0];if(c)return t||(o+=c.length),c}else{if(e instanceof Function){var l=e(n.slice(o)),p=n.slice(o,o+l);return t||(o+=l),p}if(n.slice(o).startsWith(e))return t||(o+=e.length),e}},next:function(e){return o+=e,n.slice(o-e,o)},rest:function(){return n.slice(o)}}),s=[],c=function(e,t){return s.push(function(e,t,r,n){return{start:e,end:t,str:r,type:n}}(i.pos()-e.length,i.pos(),e,t))};!i.done();){var l=i.match(/^\s*\n\s*\n\s*/);if(l)c(l,"whitespace");else if(!i.match(/^\s+/)){var p=i.match(/^"[^"]*"/);if(p)c(p,"note");else{var f=i.match([";",":",",","..","@"]);if(f)c(f);else{var d=i.match(["(",")","[","]","{","}"]);if(d)c(d);else{var h=i.match(/^[0-9]*\.[0-9]+/);if(h||(h=i.match(/^[0-9]+(\.(?!\.))?/)),h)c(h,"number");else{var y=i.match(["+","-","*","/",">=","<=",">","<","==","!","^","->",".x",".y",".","="]);if(y)c(y,"op");else{var m=i.match(/^\w+/);if(m)c(m,"ident");else{var v=i.next(1);r.push(a("did not expect '".concat(v,"'"),i.pos()-1,i.pos(),t))}}}}}}}}return s}function p(){p=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof d?t:d,a=Object.create(i.prototype),s=new T(o||[]);return n(a,"_invoke",{value:_(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var f={};function d(){}function h(){}function y(){}var v={};c(v,i,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(E([])));b&&b!==t&&r.call(b,i)&&(v=b);var x=y.prototype=d.prototype=Object.create(v);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function o(n,i,a,s){var c=l(e[n],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==m(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function _(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:N}}function N(){return{value:void 0,done:!0}}return h.prototype=y,n(x,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:h,configurable:!0}),h.displayName=c(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,s,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},w(k.prototype),c(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(x),c(x,s,"Generator"),c(x,i,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=E,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function f(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){f(i,n,o,a,s,"next",e)}function s(e){f(i,n,o,a,s,"throw",e)}a(void 0)}))}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t,r){return{type:"error",reason:e,start:t,end:r}}var g=0;function b(){return++g}function x(e){var t=e.type;return"number"==t||"point"==t||"list"==t||"block"==t||"identifier"==t||"fncall"==t||"binop"==t||"unop"==t||"range"==t||"listcomp"==t||"match"==t||"note"==t||"macrocall"==t?{success:!0,data:e}:{success:!1,data:void 0}}function w(e){return Array.isArray(e)?e.map((function(e){return w(e)})).flat():"object"==m(e)?"error"==e.type?[e]:w(Object.values(e)):[]}function k(e,t,r){!function e(t,n){if(Array.isArray(t))return t.map((function(t){return e(t,n)}));if(t&&"object"==m(t)&&"number"==typeof t.id){var o=t,i=r(o,n);Object.entries(o).forEach((function(t){var r=h(t,2);return[r[0],e(r[1],i)]}))}}(e,t)}function _(e,t,r){return S.apply(this,arguments)}function S(){return S=d(p().mark((function e(t,r,n){var o,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(){return(i=d(p().mark((function e(t,r){var i,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=4;break}return e.next=3,Promise.all(t.map((function(e){return o(e,r)})));case 3:return e.abrupt("return",e.sent);case 4:if(!t||"object"!=m(t)||"number"!=typeof t.id){e.next=11;break}return i=t,e.next=8,n(i,r);case 8:return a=e.sent,e.next=11,Promise.all(Object.entries(i).map((function(e){var t=h(e,2),r=(t[0],t[1]);return o(r,a)})));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)},o=function(e,t){return i.apply(this,arguments)},e.next=4,o(t,r);case 4:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==O(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===O(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P(e,t,r,n){var o=function(e){var t=0;return{next:function(r){if(!(t>=e.length)){if(!r)for(;e[t]&&"whitespace"==e[t].type;)t++;return t++,e[t-1]}},peek:function(r){var n=t;if(!r)for(;e[n]&&"whitespace"==e[n].type;)n++;return e[n]},done:function(r){for(var n=t;n<e.length;){if("whitespace"!=e[n].type||r)return!1;n++}return!0},prev:function(r){if(r)t--;else do{t--}while("whitespace"!=e[t].type)},prevPeek:function(r){var n=t;if(r)return n--,e[n];do{n--}while("whitespace"==e[n].type);return e[n]},stringpos:function(){var r,n,o;return null!==(r=null!==(n=null===(o=e[t])||void 0===o?void 0:o.start)&&void 0!==n?n:e[e.length-1].start)&&void 0!==r?r:0},stringposend:function(r,n){for(var o,i,a,s=Math.abs(null!=r?r:0),c=Math.sign(null!=r?r:0),u=0;s>0;){var l;("whitespace"!=(null===(l=e[t+(u+=c)])||void 0===l?void 0:l.type)||n)&&s--}return null!==(o=null!==(i=null===(a=e[t+u])||void 0===a?void 0:a.end)&&void 0!==i?i:e[e.length-1].end)&&void 0!==o?o:0},getpos:function(){return t},setpos:function(e){return t=e}}}(e),i=new Set,a={tokens:o,node:function(e,s){var c=o.stringpos(),u=o.getpos();try{var l=e({expectToken:function(e,t,r){var n,i=o.next();if(!i)throw v(null!==(n=null!=r?r:"unexpected end of input: ".concat(t))&&void 0!==n?n:"unexpected end of input: expected '".concat(e,"'"),o.stringpos(),o.stringpos());if(i.str!=e)throw v(null!=t?t:"expected '".concat(e,"', got '").concat(i.str,"'"),o.stringpos()-i.str.length-1,o.stringpos())},expectOneOfTheseTokens:function(e,t,r){var n,i=o.next();if(!i)throw v(null!==(n=null!=r?r:"unexpected end of input: ".concat(t))&&void 0!==n?n:"unexpected end of input: expected one of ".concat(e.map((function(e){return"'".concat(e,"'")})).join(", ")),o.stringpos(),o.stringpos());var a,s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return N(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}(e);try{for(s.s();!(a=s.n()).done;){var c=a.value;if(i.str==c)return i}}catch(t){s.e(t)}finally{s.f()}throw v(null!=t?t:"expected one of ".concat(e.map((function(e){return"'".concat(e,"'")})).join(", "),", got '").concat(i.str,"'"),o.stringpos()-i.str.length,o.stringpos())},expectTokenType:function(e,t,r){var n,i=o.next();if(!i)throw v(null!==(n=null!=r?r:"unexpected end of input: ".concat(t))&&void 0!==n?n:"unexpected end of input: expected a/an '".concat(e,"' token"),o.stringpos(),o.stringpos());if(i.type!=e)throw v(null!=t?t:"expected a '".concat(e,"' token; got '").concat(i.str,"' a '").concat(i.type,"' token"),o.stringpos()-i.str.length,o.stringpos());return i},expectExpression:function(e){return z(a,null!=e?e:0)},expectJson:function(e){return $(a,e)},isNextToken:function(e){var t=o.peek();return(null==t?void 0:t.str)==e},isNextTokenType:function(e){var t=o.peek();return(null==t?void 0:t.type)==e},consumeTokenIfExists:function(e){var t=o.peek();return(null==t?void 0:t.str)==e&&(o.next(),!0)},expectExpressionOrStatement:function(e,t){var r=o.getpos(),n=G(a);return"error"!=n.type?n:(o.setpos(r),z(a,0))},expectAny:function(){var e=o.getpos(),t=G(a);return"error"!=t.type?t:(o.setpos(e),$(a),"error"!=t.type?t:(o.setpos(e),z(a,0)))},error:function(e){return v(e)},tokenError:function(e){var t=o.stringpos(),r=o.stringposend();return i.has(t)&&o.next(),i.add(t),T(T({},v(e)),{},{id:b(),start:t,end:r})},peek:function(e){var t=o.peek(e);if(!t)throw v("unexpected end of input");return t},maybeNext:function(e){return o.next(e)},maybePeek:function(){return o.peek()},isEnd:function(){return o.done()},getpos:function(){return o.getpos()},setpos:function(e){o.setpos(e)},markNoReturn:function(){s=!1},highlightLastToken:function(e){var t=o.prevPeek();if(!t)throw v("cannot highlight undefined");null==n||n.push({start:t.start,end:t.end,type:e})},softError:function(e,n,o){r.push({reason:e,start:n,end:o,type:"general",unit:t})},clearErrorsFrom:function(e,t){for(var n=0;n<r.length;n++)(e>r[n].start||t<r[n].end)&&(r.splice(n,1),n--)}}),p=o.stringposend(-1);return"error"==l.type&&s&&o.setpos(u),T({id:b(),start:c,end:p},l)}catch(e){s&&o.setpos(u);var f=e;return void 0===f.start&&delete f.start,void 0===f.end&&delete f.end,T({unitName:t,id:b(),start:c,end:o.stringpos()},f)}}};return A(a,!0)}function L(e){return e.node((function(e){var t,r=[];for(e.expectToken("{");!e.isNextToken("}")&&(t=e.expectExpression(),e.isNextToken(":"));){e.expectToken(":");var n=e.expectExpression();r.push([t,n]),e.isNextToken("}")||e.expectToken(",")}var o=void 0;return(e.isNextToken("}")||e.isNextToken(","))&&(o=t),e.consumeTokenIfExists(","),e.expectToken("}"),{branches:r,fallback:o,type:"match"}}))}function A(e,t){return e.node((function(r){var n=[];for(t||r.expectToken("{");!t&&!r.isNextToken("}")&&!r.isEnd()||t&&!r.isEnd();){n.push(r.expectExpressionOrStatement());var o=n[n.length-1];(!t&&!r.isNextToken("}")||t&&!r.isEnd())&&("note"==o.type||"linebreak"==o.type?r.consumeTokenIfExists(";"):"assignment"==o.type||x(o).success?(e.tokens.stringpos(),r.isNextToken(";")||n.push(e.node((function(e){for(;!e.isNextToken(";")&&!e.isEnd();)e.maybeNext();return{reason:"expected a ';' here",type:"error"}}))),r.expectToken(";")):r.consumeTokenIfExists(";"))}return r.consumeTokenIfExists(";"),t||r.expectToken("}"),{body:n,type:"block",isRoot:t}}))}function I(e){return e.node((function(e){var t=e.expectTokenType("number");return e.highlightLastToken("number"),{number:Number(t.str),type:"number"}}))}function Z(e){return e.node((function(e){for(var t=[],r=!0;r||e.isNextToken(".")||e.isNextToken(".x")||e.isNextToken(".y");){if(!r){if(e.isNextToken(".x")||e.isNextToken(".y")){var n=e.expectTokenType("op");e.highlightLastToken("keyword"),t.push(n.str[1]);continue}e.expectToken(".")}r=!1,t.push(e.expectTokenType("ident").str),(e.isNextToken(".")||e.isNextToken(".x")||e.isNextToken(".y"))&&e.highlightLastToken("variable")}return{type:"identifier",segments:t}}))}function C(e){return e.node((function(e){var t=e.expectTokenType("note");return e.highlightLastToken("string"),{type:"note",content:t.str.slice(1,-1)}}))}var M={"^":4,"*":3,"/":3,"+":2,"-":2,">=":5,"<=":5,"==":5,">":5,"<":5,"->":6,"[":7},D={"^":!0};function U(e){var t;return null!==(t=M[e])&&void 0!==t?t:0}function R(e){var t;return null!==(t=M[e.str])&&void 0!==t?t:0}function F(e,t,r){return"["==r.str?e.node((function(e){e.maybeNext();var r=e.expectExpression();return e.expectToken("]"),{type:"binop",lhs:t,start:t.start,rhs:r,op:"["}})):"op"===r.type?function(e,t){return e.node((function(e){var r,n=e.expectTokenType("op"),o=e.expectExpression(R(n)-(null!==(r=D[n.str])&&void 0!==r&&r?1:0));return{type:"binop",lhs:t,start:t.start,rhs:o,op:n.str}}))}(e,t):void 0}function z(e,t){return e.node((function(r){for(var n=r.peek(),o=function(e,t,r){switch(r.type){case"note":return C(e);case"number":return I(e);case"ident":var n=t.getpos(),o=function(e){return e.node((function(t){var r=Z(e);if("identifier"!=r.type)return t.error("expected an identifier");t.expectToken("(");for(var n=[];!t.isEnd()&&!t.isNextToken(")")&&(n.push(t.expectExpression()),!t.isNextToken(")"));)t.expectToken(",");return t.expectToken(")"),{type:"fncall",name:r,params:n}}))}(e);if(0==w(o).length)return o;t.setpos(n);var i=function(e){return e.node((function(t){var r=Z(e);if("identifier"!=r.type)return t.error("expected an identifier");t.expectToken("!"),t.expectToken("(");for(var n=[];!t.isNextToken(")")&&(n.push(t.expectAny()),!t.isNextToken(")"));)t.expectToken(",");return t.expectToken(")"),{type:"macrocall",name:r,params:n}}))}(e);return 0==w(i).length?i:(t.setpos(n),Z(e));default:switch(r.str){case"-":return function(e){return e.node((function(e){return e.expectToken("-"),{type:"unop",op:"-",operand:e.expectExpression(6)}}))}(e);case"[":return function(e){return e.node((function(e){if(e.expectToken("["),e.isNextToken("]")){e.maybeNext(),e.expectToken("as","empty lists must have type annotations"),e.highlightLastToken("keyword");var t=e.expectOneOfTheseTokens(["point","number","polygon","color","boolean"],"invalid type: valid list type annotation types are 'point', 'number', 'polygon', 'color', or 'boolean'");return e.highlightLastToken("type"),e.expectToken("["),e.expectToken("]"),{elements:[],type:"list",typeAnnotation:t.str}}var r=e.expectExpression();return e.isNextToken(",")||e.isNextToken("]")||e.isNextToken("..")?function(e,t){var r=[t];if(e.isNextToken("]"))return e.maybeNext(),{elements:[t],type:"list"};if(e.isNextToken("..")){e.maybeNext();var n=e.expectExpression();return e.expectToken("]"),{type:"range",lhs:t,rhs:n}}e.expectToken(",");var o=e.expectExpression();if(e.isNextToken("..")){e.maybeNext();var i=e.expectExpression();return e.expectToken("]"),{type:"range",lhs:t,rhs:i,step:o}}for(r.push(o);!e.isNextToken("]")&&(e.expectToken(","),!e.isNextToken("]"));)r.push(e.expectExpression());return e.expectToken("]"),{elements:r,type:"list"}}(e,r):(e.expectToken("for"),e.highlightLastToken("keyword"),function(e,t){for(var r=[];!e.isNextToken("]");){var n=e.expectTokenType("ident").str;e.highlightLastToken("variable"),e.expectToken("=");var o=e.expectExpression();if(r.push([n,o]),e.isNextToken("]"))break;e.expectToken(",")}return e.expectToken("]"),{type:"listcomp",params:r,body:t}}(e,r))}))}(e);case"(":return function(e){return e.node((function(e){e.expectToken("(");var t=e.expectExpression();if(e.isNextToken(")"))return e.maybeNext(),t;e.expectToken(",","expected ',' (if a point) or ')' (if a paraenthesized expression)");var r=e.expectExpression();return e.expectToken(")"),{type:"point",x:t,y:r}}))}(e);case"{":var a=t.getpos(),s=A(e);return 0==w(s).length?s:(t.setpos(a),L(e))}throw t.tokenError("unexpected token '".concat(r.str,"'"))}}(e,r,n);;){if("error"==o.type)return o;var i=r.maybePeek();if(!i)break;if(R(i)<=t)break;var a=F(e,o,i);if(!a)break;o=a}return o}))}function G(e){return e.node((function(t){var r=t.peek(!0);if("whitespace"==r.type)return t.maybeNext(!0),{type:"linebreak"};switch(r.str){case"import":return function(e){return e.node((function(e){if(e.expectToken("import"),e.highlightLastToken("keyword"),e.consumeTokenIfExists("script")){e.highlightLastToken("keyword");var t=e.expectTokenType("note").str.slice(1,-1);return e.highlightLastToken("string"),{type:"import-script",src:t}}var r,n=e.expectTokenType("note").str.slice(1,-1);return e.highlightLastToken("string"),e.isNextToken("as")&&(e.maybeNext(),e.highlightLastToken("keyword"),r=e.expectTokenType("ident").str,e.highlightLastToken("namespace")),{type:"import",src:n,alias:r}}))}(e);case"fn":return function(e){return e.node((function(t){t.expectToken("fn"),t.highlightLastToken("keyword");var r=t.expectTokenType("ident").str;t.highlightLastToken("function"),t.expectToken("(");for(var n=[];!t.isNextToken(")");)n.push(t.expectTokenType("ident").str),t.highlightLastToken("variable"),t.isNextToken(")")?t.consumeTokenIfExists(","):t.expectToken(",");t.expectToken(")");var o=t.getpos(),i=A(e);return"error"==i.type&&(t.setpos(o),i=L(e)),"error"==i.type&&t.error("expected a function body surrounded by '{}' brackets or a match expression"),{type:"fndef",params:n,body:i,name:r}}))}(e);case"ns":return function(e){return e.node((function(e){e.expectToken("ns"),e.highlightLastToken("keyword");var t=e.expectTokenType("ident").str;e.highlightLastToken("namespace");var r=void 0;e.isNextToken("@")&&(r=e.expectJson());var n=e.expectExpression();return"block"!=n.type&&e.error("expected a block of expressions or statements"),{type:"namespace",body:n,name:t,settings:r}}))}(e);case"show":return function(e){return e.node((function(e){e.expectToken("show"),e.highlightLastToken("keyword");var t=e.expectExpressionOrStatement();return{type:"show",settings:e.expectJson(!0),body:t}}))}(e);case"settings":case"ticker":return function(e){return e.node((function(e){var t=e.expectOneOfTheseTokens(["settings","ticker"]);e.highlightLastToken("keyword");var r=e.expectJson();return{type:"settings",settingsType:t.str,content:r}}))}(e);default:switch(r.type){case"ident":return function(e){return e.node((function(e){var t=e.expectTokenType("ident").str;if(e.highlightLastToken("variable"),e.isNextToken("."))return e.error("Variables being assigned to cannot contain '.' characters!");e.expectToken("=");var r=e.expectExpression();if("error"==r.type)for(;!e.isNextToken(";")&&!e.isNextToken("}")&&!e.isEnd();)e.maybeNext();return{lhs:t,rhs:r,type:"assignment"}}))}(e);case"note":return C(e);default:return t.error("expected a statement")}}}))}function $(e,t){return e.node((function(r){t?(r.expectToken("@"),r.highlightLastToken("keyword")):r.isNextToken("@")&&(r.maybeNext(),r.highlightLastToken("keyword"));var n=r.peek();switch(n.type){case"number":return I(e);case"note":return C(e);case"ident":switch(n.str){case"null":return r.maybeNext(),r.highlightLastToken("macro"),{type:"json-null"};case"true":return r.maybeNext(),r.highlightLastToken("macro"),{type:"json-boolean",data:!0};case"false":return r.maybeNext(),r.highlightLastToken("macro"),{type:"json-boolean",data:!1};case"ds":r.maybeNext(),r.highlightLastToken("keyword"),r.expectToken("(");var o=r.expectExpression();return r.expectToken(")"),{type:"json-inner-expr",expr:o}}default:if("{"==n.str){r.expectToken("{");for(var i=[],a=!0;!r.isNextToken("}")&&(a||r.expectToken(","),!r.isNextToken("}"));){a=!1;var s=r.expectTokenType("ident").str;r.highlightLastToken("variable"),r.expectToken(":");var c=r.expectJson();i.push([s,c])}return r.expectToken("}"),{type:"json-object",data:i}}if("["==n.str){r.expectToken("[");for(var u=[];!r.isNextToken("]")&&(u.push(r.expectJson()),!r.isNextToken("]"));)r.expectToken(",");return r.expectToken("]"),{type:"json-array",elements:u}}return r.error("expected a desmoscript json expression")}}))}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function V(e){return function(e){if(Array.isArray(e))return Y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||W(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||W(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){if(e){if("string"==typeof e)return Y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Y(e,t):void 0}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){H(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function H(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==B(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===B(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e){return"".padStart(e," ")}function Q(e){return e.split("\n").reduce((function(e,t){return Math.max(e,t.length)}),0)}function ee(e,t){var r;r=t||{indent:0,tabSize:2,maxlen:80,bindingPower:0};var n=function(e){return J(J({},r),{},{splitByLine:void 0,dontIndentFirst:void 0},e)};switch(e.type){case"assignment":return"".concat(e.lhs," = ").concat(ee(e.rhs,n({indent:r.indent})));case"binop":if(void 0===r.splitByLine){var o=ee(e,n({splitByLine:!1}));return o.length>r.maxlen&&(o=ee(e,n({splitByLine:!0,bindingPower:U(e.op)}))),o}var i=U(e.op);if(r.splitByLine){if(i!=r.bindingPower)return ee(e,n({splitByLine:!1,bindingPower:r.bindingPower,indent:r.indent+r.tabSize}));var a=ee(e.lhs,n({bindingPower:i,splitByLine:!0})),s=ee(e.rhs,n({bindingPower:i,splitByLine:!0})),c="["==e.op?"".concat(a,"[\n").concat(s,"\n]"):"".concat(a,"\n").concat(X(r.indent)).concat(e.op," ").concat(s);return i<r.bindingPower?"(".concat(c,")"):c}var u=ee(e.lhs,n({bindingPower:i})),l=ee(e.rhs,n({bindingPower:i})),p="["==e.op?"".concat(u,"[").concat(l,"]"):"".concat(u," ").concat(e.op," ").concat(l);return i<r.bindingPower?"(".concat(p,")"):p;case"block":var f=e.isRoot?0:r.tabSize;return"".concat((r.dontIndentFirst,"")).concat(e.isRoot?"":"{").concat(e.isRoot?"":"\n").concat(e.body.map((function(t,o){return"".concat(X(r.indent+f)).concat(ee(t,n({indent:r.indent+r.tabSize+f})))+("note"!=t.type&&x(t).success&&o!=e.body.length-1||"assignment"==t.type?";":"")+"\n"})).join("")).concat(X(r.indent)).concat(e.isRoot?"":"}");case"error":return"##ERROR: ".concat(e.reason,"##");case"fncall":var d=ee(e.name),h=e.params.map((function(e){return ee(e,n({indent:r.indent+r.tabSize}))})),y="".concat(d,"(").concat(h.join(", "),")");return Q(y)>r.maxlen?"".concat(d,"(\n").concat(h.join(",\n".concat(X(r.indent+r.tabSize))),"\n").concat(X(r.indent),")"):y;case"fndef":var m=e.params.join(", "),v=n({indent:r.indent-r.tabSize,dontIndentFirst:!0}),g="fn ".concat(e.name,"(").concat(m,") ").concat(ee(e.body,v));return m.length>r.maxlen?"fn ".concat(e.name,"(\n").concat(e.params.join(",\n".concat(X(r.indent+r.tabSize))),"\n) ").concat(ee(e.body,v)):g;case"identifier":return e.segments.join(".");case"import":return'import "'.concat(e.src,'"')+(e.alias?" as ".concat(e.alias):"");case"import-script":return'import script "'.concat(e.src,'"');case"json-array":var b=n({indent:r.indent+r.tabSize}),w=e.elements.map((function(e){return ee(e,b)})),k="[".concat(w.join(", "),"]");return k.length>r.maxlen?"[\n".concat(w.join(",\n".concat(X(r.indent))),"\n").concat(X(r.indent-r.tabSize),"]"):k;case"json-boolean":return e.data?"true":"false";case"json-inner-expr":return"ds(".concat(ee(e.expr,n({indent:r.indent+r.tabSize})),")");case"json-null":return"null";case"json-object":var _=n({indent:r.indent+r.tabSize}),S=e.data.map((function(e){var t=K(e,2),r=t[0],n=t[1];return"".concat(r,": ").concat(ee(n,_))})),O="@{ ".concat(S.join(", ")," }");return O.length>r.maxlen?"@{".concat(S.map((function(e){return"\n".concat(X(r.indent)).concat(e)})).join(","),"\n").concat(X(r.indent-r.tabSize),"}"):O;case"linebreak":return"";case"list":var j=e.typeAnnotation?" as ".concat(e.typeAnnotation,"[]"):"",T=e.elements.map((function(e){return ee(e,n({indent:r.indent+r.tabSize}))})),E="[".concat(T.join(", "),"]")+j;return E.length>r.maxlen?"[".concat(T.map((function(e){return"\n".concat(X(r.indent)).concat(e)})).join(","),"\n").concat(X(r.indent-r.tabSize),"]")+j:E;case"listcomp":var N=ee(e.body,n({indent:r.indent+r.tabSize})),P=e.params.map((function(e){var t=K(e,2),o=t[0],i=t[1];return"".concat(o,"=").concat(ee(i,n({indent:r.indent+r.tabSize})))})),L="[".concat(N," for ").concat(P.join(", "),"]");return Q(L)>r.maxlen?"[".concat(N," for").concat(P.map((function(e){return"\n".concat(X(r.indent)).concat(e)})).join(","),"\n").concat(X(r.indent-r.tabSize),"]"):L;case"macrocall":var A=ee(e.name),I=e.params.map((function(e){return ee(e,n({indent:r.indent+r.tabSize}))})),Z="".concat(A,"!(").concat(I.join(", "),")");return Q(Z)>r.maxlen?"".concat(A,"!(\n").concat(I.join(",\n".concat(X(r.indent+r.tabSize))),"\n").concat(X(r.indent),")"):Z;case"match":var C=n({indent:r.indent+r.tabSize}),M=e.branches.map((function(e){var t=K(e,2),r=t[0],n=t[1];return"".concat(ee(r,C),": ").concat(ee(n,C))})),D=e.fallback?ee(e.fallback,C):"",R="{ ".concat([].concat(V(M),[D]).filter((function(e){return e})).join(", ")," }");return R.length>r.maxlen?"{".concat([].concat(V(M),[D]).filter((function(e){return e})).map((function(e){return"\n".concat(X(r.indent)).concat(e)})).join(","),"\n").concat(X(r.indent-r.tabSize),"}"):R;case"namespace":return"ns ".concat(e.name," ").concat(e.settings?ee(e.settings,n({dontIndentFirst:!0}))+" ":"").concat(ee(e.body,n({indent:r.indent-r.tabSize,dontIndentFirst:!0})));case"note":return'"'.concat(e.content,'"');case"number":return e.number.toString();case"point":var F=n({indent:r.indent+r.tabSize}),z=ee(e.x,F),G=ee(e.y,F),$="(".concat(z,", ").concat(G,")");return $.length>r.maxlen?"(\n".concat(X(r.indent+r.tabSize)).concat(z,",\n").concat(X(r.indent+r.tabSize)).concat(G,"\n)"):$;case"range":var B=n({indent:r.indent+r.tabSize}),W=ee(e.lhs,B),Y=ee(e.rhs,B);return e.step?"[".concat(W,",").concat(ee(e.step,B),"..").concat(Y,"]"):"[".concat(W,"..").concat(Y,"]");case"show":return"show ".concat(ee(e.body,r)," ").concat(ee(e.settings,r));case"unop":var q=n({indent:r.indent+r.tabSize,bindingPower:U(e.op)});return e.op.startsWith(".")?"".concat(ee(e.operand,q)).concat(e.op):"".concat(e.op).concat(ee(e.operand,q));case"settings":var H=n({indent:r.indent+r.tabSize});return"".concat(e.settingsType," ").concat(ee(e.content,H))}}function te(e){return function(e){if(Array.isArray(e))return ce(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||se(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){oe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function oe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ue(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ue(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ie(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=se(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||se(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){if(e){if("string"==typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(e,t):void 0}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function le(e,t,r,n,o,i){var a={elements:new Map,imports:[],parent:e,name:t,importScripts:[]};return e&&pe(e,t,{type:"scope",scope:a,id:b(),unitName:r.unit,start:n,end:o,isWithinFunction:i},r.errors),a}function pe(e,t,r,n){var o=e.elements.get(t);if(o&&"builtin-variable"!=o.type){var i=0,a=0;"builtin-function"!=o.type&&"macro"!=o.type&&(i=o.start,a=o.end);var s={reason:"namespace collision",type:"namespace-collision",start:i,end:a,startB:"macro"!=r.type?null==r?void 0:r.start:void 0,endB:"macro"!=r.type?null==r?void 0:r.end:void 0,unitB:r.unitName,unit:o.unitName};n.push(s)}e.elements.set(t,r)}function fe(e,t,r){var n,o,i,s=function(n,o,i){return fe(n,{parentNode:e,scope:null!=o?o:t.scope,isValueBlock:null==i||i},r)},c=function(){var e;return"show"==(null===(e=t.parentNode)||void 0===e?void 0:e.type)?t.parentNode.settings.id:void 0};switch(e.type){case"fndef":var u=le(t.scope,b().toString(),r,e.start,e.end,!0);u.name=e.name,pe(t.scope,e.name,{type:"function",node:e.id,start:e.start,end:e.end,unitName:r.unit,display:c(),id:b()},r.errors);var l,p=ie(e.params);try{for(p.s();!(l=p.n()).done;)pe(u,l.value,{type:"builtin-variable",unitName:r.unit,id:b()},r.errors)}catch(e){p.e(e)}finally{p.f()}return ne(ne({},e),{},{innerScope:u,enclosingScope:t.scope,body:s(e.body,u)});case"namespace":var f=le(t.scope,e.name,r,e.start,e.end);return ne(ne({},e),{},{innerScope:f,enclosingScope:t.scope,body:s(e.body,f,!1),settings:e.settings?s(e.settings,t.scope):void 0});case"listcomp":var d,h=le(t.scope,"listcomp"+b().toString(),r,e.start,e.end),y=ie(e.params);try{for(y.s();!(d=y.n()).done;){var m=ae(d.value,2),v=m[0];m[1],pe(h,v,{type:"builtin-variable",unitName:r.unit,id:b()},r.errors)}}catch(e){y.e(e)}finally{y.f()}return ne(ne({},e),{},{innerScope:h,enclosingScope:t.scope,body:s(e.body,h),params:e.params.map((function(e){return[e[0],s(e[1],t.scope)]}))});case"block":var g,w,k="fndef"==(null===(g=t.parentNode)||void 0===g?void 0:g.type)||"namespace"==(null===(w=t.parentNode)||void 0===w?void 0:w.type)||e.isRoot?t.scope:le(t.scope,"block"+b().toString(),r,e.start,e.end);return ne(ne({},e),{},{innerScope:k,enclosingScope:t.scope,body:e.body.map((function(e){return s(e,k)}))});case"assignment":pe(t.scope,e.lhs,{type:"variable",node:e.id,start:e.start,end:e.end,unitName:r.unit,display:c(),id:b()},r.errors);break;case"note":pe(t.scope,b().toString(),{type:"note",text:e.content,start:e.start,end:e.end,unitName:r.unit,id:b()},r.errors);break;case"import":var _=r.resolveImport(e.src,r.unit);if(void 0===_){r.errors.push(a("failed to import '".concat(e.src,"'"),e.start,e.end,r.unit));break}"import"==e.type&&e.alias?pe(t.scope,e.alias,{type:"import",compilationUnitPath:_,start:e.start,end:e.end,unitName:r.unit,id:b()},r.errors):t.scope.imports.push({compilationUnitPath:_,start:e.start,end:e.end});break;case"import-script":var S=r.getAbsolutePath(r.unit,e.src);if(!S){r.errors.push({type:"general",start:e.start,end:e.end,reason:"Import script '".concat(S,"' does not exist."),unit:r.unit});break}var O=r.importScripts.get(S);O||r.errors.push({type:"general",start:e.start,end:e.end,reason:"Import script '".concat(S,"' does not exist."),unit:r.unit}),null==O||O.run({scope:t.scope});break;case"settings":pe(t.scope,b().toString(),{type:"settings",settings:e.content.id,start:e.start,settingsType:e.settingsType,end:e.end,unitName:r.unit,id:b()},r.errors);break;case"macrocall":if(e.result&&!(e.result instanceof Promise))return ne(ne({},e),{},{enclosingScope:t.scope,params:e.params,name:s(e.name),result:fe(e.result,{parentNode:t.parentNode,scope:t.scope},r)})}return x(e).success&&"note"!=e.type&&("macrocall"!=e.type||e.result&&!(e.result instanceof Promise)&&x(e.result).success)&&("block"==(null===(n=t.parentNode)||void 0===n?void 0:n.type)&&(e!=t.parentNode.body[t.parentNode.body.length-1]||!t.isValueBlock||null!==(o=t.parentNode)&&void 0!==o&&o.isRoot)||"show"==(null===(i=t.parentNode)||void 0===i?void 0:i.type))&&pe(t.scope,b().toString(),{type:"expression",start:e.start,end:e.end,unitName:r.unit,id:b(),expr:e.id,display:c()},r.errors),function(e,t){return function t(r){if(Array.isArray(r))return r.map((function(e){return t(e)}));if(r&&"object"==ue(r)&&"number"==typeof r.id){if(r!==e)return s(r);var n=r;return Object.fromEntries(Object.entries(n).map((function(e){var r=ae(e,2);return[r[0],t(r[1])]})))}return r}(e)}(ne(ne({},e),{},{enclosingScope:t.scope}))}function de(e,t){return e?[].concat(te(de(e.parent)),te(null!=t?t:[e.name])):null!=t?t:[]}function he(e,t,r,n,o){if(null!=o&&o.has(e.name))return{result:"not-found"};for(var i=[],a=t;a;)i.push(a),a=a.parent;for(var c=0,u=i;c<u.length;c++)for(var l=u[c],p=0;p<r.length;p++){var f=r[p],d=l.elements.get(f);if(d){if(p==r.length-1)return{result:"found",identifier:d};if("scope"==d.type)l=d.scope;else{if("import"!=d.type){if(p==r.length-2&&"variable"==d.type&&("x"==r[r.length-1]||"y"==r[r.length-1]))return{result:"point-member-access",identifier:d,memberAccess:r[r.length-1]};break}var h=n.compilationUnits.get(d.compilationUnitPath);if(!h)throw s("expected a valid absolute import path; got '".concat(d.compilationUnitPath,"'"));l=h.scopeTree}}else{var y,m=ie(l.imports);try{for(m.s();!(y=m.n()).done;){var v=y.value,g=n.compilationUnits.get(v.compilationUnitPath);if(null==o||o.add(v.compilationUnitPath),!g)throw s("expected a valid absolute import path; got '".concat(v.compilationUnitPath,"'"));var b=he(g,g.scopeTree,r.slice(p),n,null!=o?o:new Set(e.name));if("not-found"!=b.result)return b}}catch(e){m.e(e)}finally{m.f()}}}return{result:"not-found"}}function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach((function(t){ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ge(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ye(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ye(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||we(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=we(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function we(e,t){if(e){if("string"==typeof e)return ke(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ke(e,t):void 0}}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _e(e,t,r,n,o){Array.from(r.entries()).reverse();var i,a,s,c=[],u=xe(Array.from(r.entries()).reverse());try{for(u.s();!(s=u.n()).done;){var l,p,f=be(s.value,2),d=(f[0],f[1]);if(c.push({start:null!==(l=d.node.start)&&void 0!==l?l:0,end:null!==(p=d.node.end)&&void 0!==p?p:0,unit:d.nodeUnit}),o.add(d.content.id),n.id==d.content.id)break}}catch(e){u.e(e)}finally{u.f()}return c.reverse(),je([{type:"circular-dependency",start:null!==(i=n.start)&&void 0!==i?i:0,end:null!==(a=n.end)&&void 0!==a?a:0,unit:n.unitName,path:c,reason:"circular dependency: "}])}function Se(e,t,r){return je([{type:"not-found",start:e.start,end:e.end,unit:t,reason:r}])}function Oe(e,t,r){return je([{type:"wrong-type",start:e.start,end:e.end,unit:t,reason:r}])}function je(e){return{type:"error",why:e}}function Te(e){return e.replace("-"," ")}function Ee(e,t){var r="".padEnd(t," ");return r+e.replace(/\n/g,"\n"+r)}function Ne(e,t,r){r||(r=2);var n=e.sourceCode.get(t.unit),o=be(n.linesAndCols[t.start],2),i=(o[0],o[1],function(e,t,r){for(;t>=0;){if("\n"==e[t]&&r--,0==r)return t;t--}return 0}(n.src,t.start,r-1)),a=function(e,t,r){for(;t<e.length;){if("\n"==e[t]&&r--,0==r)return t;t++}return e.length}(n.src,t.end,r),s=n.linesAndCols[i][0],c=Math.floor(Math.log10(s+2))+1;return"\n".concat(n.src.slice(i,t.start)).concat(e.format(n.src.slice(t.start,t.end),{type:"error"})).concat(n.src.slice(t.end,a)).replace(/\n/g,(function(t){return"\n"+e.format((s++).toString().padEnd(c," ")+"| ",{type:"gutter"})}))}function Pe(e,t){var r,n,i=e.sourceCode.get(t.unit);o(t,t.start);var a,s,c,u=be(i.linesAndCols[null!==(r=t.start)&&void 0!==r?r:0]||[0,0],2),l=u[0],p=u[1],f=(a="Error in ".concat(e.io.relativePath(e.entry,t.unit),":").concat(l,":").concat(p," ").concat(e.format("(".concat(t.unit,":").concat(l,":").concat(p,")"),{type:"deemphasize"})),s=e.maxWidth,a.split("\n").map((function(e){var t,r,n,o=null!==(t=null===(r=e.match(/^ */))||void 0===r?void 0:r[0].length)&&void 0!==t?t:0,i=[],a="",c=e.split(" "),u=0,l=xe(c);try{for(l.s();!(n=l.n()).done;)(a+=n.value).length>s||u==c.length-1?(i.push(a),a=""):a+=" ",u++}catch(e){l.e(e)}finally{l.f()}return i.join("\n".padEnd(o+1," "))})).join("\n")+(e.hideSourceCode?"":Ne(e,t,null!==(n=e.sourceCodeErrorContext)&&void 0!==n?n:2))+"\n"+e.format(t.reason,{type:"message"}));return"bad-fncall"==t.type||"bad-macro"==t.type?f+"\n\n"+t.why.map((function(t){return Ee(Pe(ve(ve({},e),{},{hideSourceCode:!1}),t),2)})).join("\n  "):"circular-dependency"==t.type?f+[].concat((c=t.path,function(e){if(Array.isArray(e))return ke(e)}(c)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||we(c)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[t.path[0]]).map((function(t){var r=t.start,n=t.end,o=t.unit,i=e.sourceCode.get(o),a=be(i.linesAndCols[r]||[0,0],2);return a[0],a[1],i.src.slice(r,n)||""})).join(" -> ")+"\n\n"+Ee(t.path.map((function(t){var r,n=t.start,o=t.end,i=t.unit,a=be(e.sourceCode.get(i).linesAndCols[n]||[0,0],2),s=a[0],c=a[1];return"".concat(e.format("At ".concat(i,":").concat(s,":").concat(c),{type:"deemphasize"})).concat(Ee(Ne(e,{start:n,end:o,unit:i},null!==(r=e.sourceCodeErrorContext)&&void 0!==r?r:2),2))})).join("\n"),2):f}function Le(e,t,r){var n=r(e,t);if(n)return n;var o=void 0;return"list"==e.type?o="list"==t.type?r(e.element,t.element):r(e.element,t):"list"==t.type&&(o=r(e,t.element)),o?{type:"list",element:o}:void 0}function Ae(e){var t=e.filter((function(e){return"error"==e.type})),r={type:"error",why:t.map((function(e){return e.why})).flat()};if(0!=t.length)return r}function Ie(){Ie=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new O(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function d(){}function h(){}var y={};c(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==t&&r.call(v,i)&&(y=v);var g=h.prototype=f.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(n,i,a,s){var c=l(e[n],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==Re(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function Ze(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(r),!0).forEach((function(t){De(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function De(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Re(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Re(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Re(e){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Re(e)}function Fe(e,t,r){return"string"==typeof e?{reason:e,type:"general",unit:r,start:t.start,end:t.end}:e}function ze(e,t){return Me(Me({},function r(n){if(Array.isArray(n))return n.map((function(e){return r(e)}));if(n&&"object"==Re(n)&&"number"==typeof n.id){if(n!==e)return t(n);var o=n;return Object.fromEntries(Object.entries(o).map((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,n)||function(e,t){if(e){if("string"==typeof e)return Ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ue(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return[o[0],r(o[1])]})))}return n}(e)),{},{id:b()})}function Ge(e){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge(e)}function $e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(r),!0).forEach((function(t){Ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ve(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Ge(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ge(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ke(){Ke=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new O(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function d(){}function h(){}var y={};c(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==t&&r.call(v,i)&&(y=v);var g=h.prototype=f.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(n,i,a,s){var c=l(e[n],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==Ge(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function We(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ye(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){We(i,n,o,a,s,"next",e)}function s(e){We(i,n,o,a,s,"throw",e)}a(void 0)}))}}function qe(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=He(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function Je(e){return function(e){if(Array.isArray(e))return Xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||He(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){if(e){if("string"==typeof e)return Xe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Xe(e,t):void 0}}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Qe=["x","y","t","index","theta"];var et,tt=function(e,t){return[{type:"regular",params:[[{type:"list",element:e}]],returns:null!=t?t:e},{type:"variadic",validTypes:[e],returns:null!=t?t:e},{type:"variadic",validTypes:[e,{type:"list",element:e}],returns:{type:"list",element:null!=t?t:e}}]},rt=function(e){return[{type:"regular",params:new Array(e).fill(0).map((function(e){return[{type:"number"}]})),returns:{type:"number"}},{type:"regular",params:new Array(e).fill(0).map((function(e){return[{type:"number"},{type:"list",element:{type:"number"}}]})),returns:nt({type:"number"})}]},nt=function(e){return{type:"list",element:e}},ot=[{type:"regular",params:[[{type:"distribution"}]],returns:{type:"distribution"}},{type:"regular",params:[[nt({type:"distribution"})]],returns:nt({type:"distribution"})}],it=[{type:"number"},{type:"polygon"},{type:"color"},{type:"point"}],at=[{type:"number"},nt({type:"number"})],st=[].concat(Je(["min","max","stdev","mean","median"].map((function(e){return[e,[].concat(Je(tt({type:"number"})),ot)]}))),[["normaldist",[{type:"regular",params:[at,at],returns:{type:"distribution"},requiredCount:0}]],["uniformdist",[{type:"regular",params:[at,at],returns:{type:"distribution"},requiredCount:0}]],["binomialdist",[{type:"regular",params:[at,at],returns:{type:"distribution"},requiredCount:1}]]],Je(["sin","cos","tan","csc","sec","cot","arcsin","arccos","arccsc","arcsec","arccot","sinh","cosh","tanh","csch","sech","coth","floor","ceil","round"].map((function(e){return[e,rt(1)]}))),[["arctan",[].concat(Je(rt(1)),Je(rt(2)))],["mod",rt(2)],["join",it.map((function(e){return{type:"variadic",minArgs:2,validTypes:[e,nt(e)],returns:nt(e)}}))],["sort",it.map((function(e){return{type:"regular",params:[[nt(e)],[nt({type:"number"})]],returns:nt(e),requiredCount:1}}))],["unique",it.map((function(e){return{type:"regular",params:[[nt(e)]],returns:nt(e)}}))],["polygon",[].concat(Je(tt({type:"point"},{type:"polygon"})),[{type:"regular",params:[[nt({type:"number"})],[nt({type:"number"})]],returns:{type:"number"}}])],["distance",[{type:"regular",params:[[{type:"point"}],[{type:"point"}]],returns:{type:"number"}},{type:"regular",params:[[{type:"point"},nt({type:"point"})],[{type:"point"},nt({type:"point"})]],returns:nt({type:"number"})}]]],Je(["rgb","hsv"].map((function(e){return[e,[{type:"regular",params:new Array(3).fill(0).map((function(e){return[{type:"number"}]})),returns:{type:"color"}},{type:"regular",params:new Array(3).fill(0).map((function(e){return[{type:"number"},nt({type:"number"})]})),returns:nt({type:"color"})}]]}))),[["random",[].concat(Je(it.map((function(e){return[{type:"regular",params:[[nt(e)]],returns:e},{type:"regular",params:[[nt(e)],[{type:"number"}],[{type:"number"}]],returns:nt(e),requiredCount:2}]})).flat(1)),[{type:"regular",params:[],returns:{type:"number"}},{type:"regular",params:[[{type:"number"}],[{type:"number"}]],returns:nt({type:"number"})}])],["shuffle",it.map((function(e){return[{type:"regular",params:[[nt(e)],[{type:"number"}]],returns:nt(e),requiredCount:1}]})).flat(1)]]);function ct(e){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ct(e)}function ut(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return lt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?lt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pt(e,t){var r,n=ut(t);try{for(n.s();!(r=n.n()).done;){var o=r.value;if("list"!=e.type||"list"!=o.type){if(e.type==o.type)return!0}else if(e.element.type==o.element.type)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}function ft(e){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ft(e)}function dt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||gt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function yt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(r),!0).forEach((function(t){mt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function mt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ft(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ft(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vt(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gt(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function gt(e,t){if(e){if("string"==typeof e)return bt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?bt(e,t):void 0}}function bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xt(e){return"list"==e.type?"".concat(xt(e.element),"[]"):e.type}function wt(e,t,r){var n=e.astNodes.get(t);if(!n)throw s("ast node map lookup failed");if(n.type!=r)throw s("ast node map lookup failed: expected a node of type '".concat(r,"' but got a '").concat(n.type,"' node"));return n}function kt(e,t){var r=e.astNodes.get(t);if(!r)throw s("ast node map lookup failed");var n=x(r);if(!n.success)throw s("ast node map lookup failed: expected an expression but got a non-expression");return n.data}function _t(e,t){var r,n=new Map(e.knownTypes),o=vt(t.entries());try{for(o.s();!(r=o.n()).done;){var i=dt(r.value,2),a=i[0],s=i[1];n.set(a,s)}}catch(e){o.e(e)}finally{o.f()}return yt(yt({},e),{},{knownTypes:n})}function St(e,t){var r=e.innerScope.elements.get(t);if(!r)throw s("expected '".concat(t,"' to be defined in this inner scope"));if("builtin-variable"!=r.type)throw s("expected '".concat(t,"' to be a builtin variable"));return r}function Ot(e,t){var r=he(t.units.get(t.unitName),e.enclosingScope,e.name.segments,{compilationUnits:t.units});if("found"!=r.result)return Se(e.name,t.unitName,"could not find a function with the name '".concat(e.name.segments.join("."),"'"));var n,o=r.identifier,i=[],a=vt(e.params);try{for(a.s();!(n=a.n()).done;){var s=n.value;i.push(jt(s,t))}}catch(e){a.e(e)}finally{a.f()}if("function"==o.type){if(t.dependencyChain.has(o.id))return _e(0,t.units,t.dependencyChain,o,t.knownCircularDependencies);var c=wt(t,o.node,"fndef"),u=c.params;if(u.length!=e.params.length)return Oe(e,t.unitName,"wrong number of parameters: function '".concat(e.name.segments.join("."),"' takes ").concat(u.length," parameters, but it was given ").concat(e.params.length," parameters here"));for(var l=new Map,p=0;p<u.length;p++){var f=St(c,u[p]).id;l.set(f,i[p])}var d=new Map(t.dependencyChain);d.set(o.id,{content:o,node:c,nodeUnit:t.unitName});var h=jt(c.body,_t(yt(yt({},t),{},{dependencyChain:d}),l));return"error"==h.type?{type:"error",why:[{type:"bad-fncall",reason:"cannot call '".concat(e.name.segments.join("."),"' due to bad parameters because:"),start:e.start,end:e.end,why:h.why,unit:t.unitName}]}:h}return"builtin-function"==o.type?function(e,t,r,n){var o,i=ut(r.typeSignature);try{var a=function(){var e,r=o.value;if("variadic"!=r.type){var n;if(t.length>r.params.length||t.length<(null!==(n=r.requiredCount)&&void 0!==n?n:r.params.length))return"continue";for(var i=0;i<t.length;i++)if(!pt(t[i],r.params[i]))return"continue|outer";return{v:r.returns}}if(t.length>=(null!==(e=r.minArgs)&&void 0!==e?e:0)&&t.every((function(e){return pt(e,r.validTypes)})))return{v:r.returns}};for(i.s();!(o=i.n()).done;){var s=a();if("continue"!==s&&"continue|outer"!==s&&"object"===ct(s))return s.v}}catch(e){i.e(e)}finally{i.f()}return Oe(e,n.unitName,"invalid function parameters; valid overloads are:\n"+Ee(r.typeSignature.map((function(e){return function(e){if("regular"==e.type)return"(".concat(e.params.map((function(t){return t.map((function(t,r){return void 0!==e.requiredCount&&r>=e.requiredCount?"[".concat(xt(t),"]"):xt(t)})).join(" | ")})).join(", "),") -> ").concat(xt(e.returns));var t=e.validTypes.map((function(e){return xt(e)})).join(" | ");return"(".concat(e.minArgs?"".concat(new Array(e.minArgs).fill(t).join(", "),", "):"","...").concat(e.validTypes.length>1?"(":"").concat(t).concat(e.validTypes.length>1?")":"","[]) -> ").concat(xt(e.returns))}(e)})).join("\n"),2))}(e,i,o,t):Oe(e.name,t.unitName,"expected this name to refer to a function; got a/an ".concat(Te(o.type)," instead"))}function jt(e,t){switch(e.type){case"binop":return function(e,t){var r,n=jt(e.lhs,t),o=jt(e.rhs,t),i=Ae([n,o]);if(i)return i;switch(e.op){case"+":case"-":r=Le(n,o,(function(e,t){return"number"==e.type&&"number"==t.type?{type:"number"}:"point"==e.type&&"point"==t.type?{type:"point"}:void 0}));break;case"*":case"/":r=Le(n,o,(function(e,t){return"number"==e.type&&"number"==t.type?{type:"number"}:"point"==e.type&&"point"==t.type||"number"==e.type&&"point"==t.type||"point"==e.type&&"number"==t.type?{type:"point"}:void 0}));break;case"^":case"%":r=Le(n,o,(function(e,t){if("number"==e.type&&"number"==t.type)return{type:"number"}}));break;case"<":case"<=":case"==":case">=":case">":r=function(e,t){return Le(e,t,(function(e,t){if("number"==e.type&&"number"==t.type)return{type:"boolean"}}))}(n,o);break;case"&&":case"||":r=function(e,t){return Le(e,t,(function(e,t){if(!("number"!=e.type&&"boolean"!=e.type||"number"!=t.type&&"boolean"!=t.type))return{type:"boolean"}}))}(n,o);break;case"[":r=function(e,t){if("list"==e.type)return"number"==t.type?e.element:"list"!=t.type||"number"!=t.element.type&&"boolean"!=t.element.type?void 0:e}(n,o);break;case"->":r={type:"action"}}return r||Oe(e,t.unitName,"cannot use operator '".concat(e.op,"' on types '").concat(xt(n),"' and '").concat(xt(o),"'"))}(e,t);case"block":return function(e,t){var r=e.body[e.body.length-1];if(!r)return Oe(e,t.unitName,"a block must contain at least one expression for it to be a valid expression (i.e. something that resolves to a value)");var n=x(r);return n.success?jt(n.data,t):Oe(r,t.unitName,"this statement is the last one within a block expression and therefore must also be an expression (something that resolves to a value)")}(e,t);case"error":return{type:"error",why:[{type:"wrong-type",start:e.start,end:e.end,unit:e.unitName,reason:e.reason}]};case"fncall":return Ot(e,t);case"identifier":return function(e,t){var r=e.enclosingScope,n=he(t.units.get(t.unitName),r,e.segments,{compilationUnits:t.units});if("point-member-access"==n.result)return{type:"number"};if("not-found"==n.result)return Se(e,t.unitName,"identifier '".concat(e.segments.join("."),"' does not exist"));if(t.knownCircularDependencies.has(n.identifier.id))return{type:"error",why:[]};if("variable"==n.identifier.type){if(t.dependencyChain.has(n.identifier.id))return _e(0,t.units,t.dependencyChain,n.identifier,t.knownCircularDependencies);var o=wt(t,n.identifier.node,"assignment"),i=new Map(t.dependencyChain);return i.set(n.identifier.id,{content:n.identifier,node:e,nodeUnit:t.unitName}),jt(o.rhs,yt(yt({},t),{},{dependencyChain:i}))}if("builtin-variable"==n.identifier.type){if(n.identifier.typeSignature)return n.identifier.typeSignature;var a=t.knownTypes.get(n.identifier.id);if(!a)throw s("builtin variables should have their types provided! builtin variable was ".concat(e.segments.join(".")));return a}return Oe(e,t.unitName,"expected an identifier representing a variable but found a/an ".concat(Te(n.identifier.type)," instead"))}(e,t);case"list":return function(e,t){if(0==e.elements.length){if(!e.typeAnnotation)throw s("Expected a type annotation, as this is an empty list! This should be caught during parsing!");return{type:e.typeAnnotation}}var r=e.elements.map((function(e){return jt(e,t)})),n=Ae(r);if(n)return n;var o=r[0];if("list"==o.type)return Oe(e.elements[0],t.unitName,"desmoscript does not support lists of lists");var i,a=vt(e.elements.slice(1));try{for(a.s();!(i=a.n()).done;){var c=i.value,u=jt(c,t);if(u.type!=o.type)return Oe(c,t.unitName,"based on its first element, this is a list of ".concat(o.type,"s, but this element is of type '").concat(xt(u),"'"))}}catch(n){a.e(n)}finally{a.f()}return{type:"list",element:o}}(e,t);case"listcomp":return function(e,t){var r,n=new Map,o=e.params.map((function(e){return[e[0],jt(e[1],t),e[1]]})),i=Ae(function(e){if(Array.isArray(e))return bt(e)}(r=o.map((function(e){return e[1]})))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||gt(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());if(i)return i;var a,s=vt(o);try{for(s.s();!(a=s.n()).done;){var c=dt(a.value,3),u=c[0],l=c[1],p=c[2];if("list"!=l.type)return Oe(p,t.unitName,"list comprehension parameters must be lists, but '".concat(u,"', an expression of type '").concat(xt(l),"', was received instead"));var f=e.innerScope.elements.get(u);n.set(f.id,l.element)}}catch(i){s.e(i)}finally{s.f()}var d=jt(e.body,_t(t,n));return Ae([d])||("list"==d.type?Oe(e.body,t.unitName,"list comprehension body cannot be a list, as desmos does not support nested lists"):{type:"list",element:d})}(e,t);case"macrocall":return function(e,t){var r=e.result;if(!r)return Oe(e,t.unitName,"unresolved macro!");if(r instanceof Promise)return Oe(e,t.unitName,"unawaited macro!");var n=w(r);if(n.length>0)return function(e,t,r,n){return je([{type:"bad-macro",start:e.start,end:e.end,unit:r,reason:"error in macro body",why:t.map((function(e){return ve(ve({},e),{},{type:"general",unit:e.unitName})}))}])}(e,n,t.unitName);var o=x(r);return o.success?jt(o.data,t):Oe(e,t.unitName,"expected this macro to resolve to an expression, but received '".concat(ee(r,{indent:2,tabSize:2,maxlen:80,bindingPower:0}),"' instead"))}(e,t);case"match":return function(e,t){var r,n,o,i,a,s=e.branches.map((function(e){return[e[0],e[1],jt(e[0],t),jt(e[1],t)]})),c=e.fallback?jt(e.fallback,t):void 0,u=null!==(r=null!==(n=null===(o=s[0])||void 0===o?void 0:o[3])&&void 0!==n?n:c)&&void 0!==r?r:{type:"number"},l=[],p=function(e,r){r.type!=u.type&&l.push(Oe(e,t.unitName,"all match branches must resolve to the same type; expected a ".concat(xt(u)," based on the first branch but got a ").concat(xt(r))))},f=vt(s);try{for(f.s();!(i=f.n()).done;){var d=dt(i.value,4),h=d[0],y=d[1],m=d[2],v=d[3];"boolean"!=m.type&&l.push(Oe(h,t.unitName,"expected a boolean, got a ".concat(xt(m)))),p(y,v)}}catch(a){f.e(a)}finally{f.f()}return e.fallback&&c&&p(e.fallback,c),Ae([s.map((function(e){return[e[2],e[3]]})),null!=c?c:[]].flat(2))||u}(e,t);case"note":return Oe(e,t.unitName,"a note cannot be used in this context");case"number":return{type:"number"};case"range":return function(e,t){var r=jt(e.lhs,t),n=jt(e.rhs,t),o=e.step?jt(e.step,t):void 0,i=Ae([r,n].concat(o?[o]:[]));if(i)return i;var a,s=vt([[e.lhs,r],[e.rhs,n]].concat(o&&e.step?[[e.step,o]]:[]));try{for(s.s();!(a=s.n()).done;){var c=dt(a.value,2),u=c[0],l=c[1];if("number"!=l.type)return Oe(u,t.unitName,"range arguments must be numbers but a ".concat(xt(l)," was received instead"))}}catch(i){s.e(i)}finally{s.f()}return{type:"list",element:{type:"number"}}}(e,t);case"unop":return function(e,t){var r=jt(e.operand,t);if("error"==r.type)return r;switch(e.op){case"!":return"boolean"!=r.type?Oe(e.operand,t.unitName,"expected a boolean; got a ".concat(xt(r))):{type:"boolean"};case"-":return-1==["number","point"].indexOf("list"==r.type?r.element.type:r.type)?Oe(e.operand,t.unitName,"cannot negate a ".concat(xt(r))):r;case".x":case".y":return"point"!=r.type?Oe(e.operand,t.unitName,"cannot access the ".concat(e.op[1]," component of a ").concat(xt(r)," or anything else that isn't a point")):{type:"number"}}}(e,t);case"point":return function(e,t){var r=jt(e.x,t),n=jt(e.y,t);return Ae([r,n])||("number"!=r.type?Oe(e.x,t.unitName,"expected a number"):"number"!=n.type?Oe(e.y,t.unitName,"expected a number"):{type:"point"})}(e,t)}}function Tt(e,t,r){r||(r=[]);var n,o=vt(e.elements);try{for(o.s();!(n=o.n()).done;){var i=dt(n.value,2),a=(i[0],i[1]);switch(a.type){case"function":break;case"variable":var s=wt(t,a.node,"assignment");r.push(jt(s.rhs,t));break;case"expression":r.push(jt(kt(t,a.expr),t));break;case"scope":a.isWithinFunction||Tt(a.scope,t,r);break;case"import":Tt(c(t.units.get(a.compilationUnitPath),"'".concat(a.compilationUnitPath,"' not found in typecheckScopeTree")).scopeTree,yt(yt({},t),{},{unitName:a.compilationUnitPath}),r)}}}catch(e){o.e(e)}finally{o.f()}return Ae(r)}!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(et||(et={}));const Et=et.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Nt=e=>{switch(typeof e){case"undefined":return Et.undefined;case"string":return Et.string;case"number":return isNaN(e)?Et.nan:Et.number;case"boolean":return Et.boolean;case"function":return Et.function;case"bigint":return Et.bigint;case"symbol":return Et.symbol;case"object":return Array.isArray(e)?Et.array:null===e?Et.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Et.promise:"undefined"!=typeof Map&&e instanceof Map?Et.map:"undefined"!=typeof Set&&e instanceof Set?Et.set:"undefined"!=typeof Date&&e instanceof Date?Et.date:Et.object;default:return Et.unknown}},Pt=et.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Lt extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(const o of e.issues)if("invalid_union"===o.code)o.unionErrors.map(n);else if("invalid_return_type"===o.code)n(o.returnTypeError);else if("invalid_arguments"===o.code)n(o.argumentsError);else if(0===o.path.length)r._errors.push(t(o));else{let e=r,n=0;for(;n<o.path.length;){const r=o.path[n];n===o.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(o))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,et.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Lt.create=e=>new Lt(e);const At=(e,t)=>{let r;switch(e.code){case Pt.invalid_type:r=e.received===Et.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Pt.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,et.jsonStringifyReplacer)}`;break;case Pt.unrecognized_keys:r=`Unrecognized key(s) in object: ${et.joinValues(e.keys,", ")}`;break;case Pt.invalid_union:r="Invalid input";break;case Pt.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${et.joinValues(e.options)}`;break;case Pt.invalid_enum_value:r=`Invalid enum value. Expected ${et.joinValues(e.options)}, received '${e.received}'`;break;case Pt.invalid_arguments:r="Invalid function arguments";break;case Pt.invalid_return_type:r="Invalid function return type";break;case Pt.invalid_date:r="Invalid date";break;case Pt.invalid_string:"object"==typeof e.validation?"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:et.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Pt.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(e.minimum)}`:"Invalid input";break;case Pt.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(e.maximum)}`:"Invalid input";break;case Pt.custom:r="Invalid input";break;case Pt.invalid_intersection_types:r="Intersection results could not be merged";break;case Pt.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Pt.not_finite:r="Number must be finite";break;default:r=t.defaultError,et.assertNever(e)}return{message:r}};let It=At;function Zt(){return It}const Ct=e=>{const{data:t,path:r,errorMaps:n,issueData:o}=e,i=[...r,...o.path||[]],a={...o,path:i};let s="";const c=n.filter((e=>!!e)).slice().reverse();for(const e of c)s=e(a,{data:t,defaultError:s}).message;return{...o,path:i,message:o.message||s}};function Mt(e,t){const r=Ct({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Zt(),At].filter((e=>!!e))});e.common.issues.push(r)}class Dt{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const n of t){if("aborted"===n.status)return Ut;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t)r.push({key:await e.key,value:await e.value});return Dt.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const n of t){const{key:t,value:o}=n;if("aborted"===t.status)return Ut;if("aborted"===o.status)return Ut;"dirty"===t.status&&e.dirty(),"dirty"===o.status&&e.dirty(),(void 0!==o.value||n.alwaysSet)&&(r[t.value]=o.value)}return{status:e.value,value:r}}}const Ut=Object.freeze({status:"aborted"}),Rt=e=>({status:"dirty",value:e}),Ft=e=>({status:"valid",value:e}),zt=e=>"aborted"===e.status,Gt=e=>"dirty"===e.status,$t=e=>"valid"===e.status,Bt=e=>void 0!==typeof Promise&&e instanceof Promise;var Vt;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Vt||(Vt={}));class Kt{constructor(e,t,r,n){this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._path.concat(this._key)}}const Wt=(e,t)=>{if($t(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,error:new Lt(e.common.issues)}};function Yt(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:o}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:o}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=n?n:t.defaultError}:{message:null!=r?r:t.defaultError},description:o}}class qt{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Nt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Nt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Dt,ctx:{common:e.parent.common,data:e.data,parsedType:Nt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Bt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nt(e)},o=this._parseSync({data:e,path:n.path,parent:n});return Wt(n,o)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nt(e)},n=this._parse({data:e,path:r.path,parent:r}),o=await(Bt(n)?n:Promise.resolve(n));return Wt(r,o)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const o=e(t),i=()=>n.addIssue({code:Pt.custom,...r(t)});return"undefined"!=typeof Promise&&o instanceof Promise?o.then((e=>!!e||(i(),!1))):!!o||(i(),!1)}))}refinement(e,t){return this._refinement(((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1)))}_refinement(e){return new Ir({schema:this,typeName:Br.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Zr.create(this)}nullable(){return Cr.create(this)}nullish(){return this.optional().nullable()}array(){return fr.create(this)}promise(){return Ar.create(this)}or(e){return vr.create([this,e])}and(e){return wr.create(this,e)}transform(e){return new Ir({schema:this,typeName:Br.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new Mr({innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:Br.ZodDefault})}brand(){return new Fr({typeName:Br.ZodBranded,type:this,...Yt(void 0)})}catch(e){return new Dr({innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:Br.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return zr.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Jt=/^c[^\s-]{8,}$/i,Ht=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,Xt=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;class Qt extends qt{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement((t=>e.test(t)),{validation:t,code:Pt.invalid_string,...Vt.errToObj(r)}),this.nonempty=e=>this.min(1,Vt.errToObj(e)),this.trim=()=>new Qt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Et.string){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.string,received:t.parsedType}),Ut}const t=new Dt;let r;for(const o of this._def.checks)if("min"===o.kind)e.data.length<o.value&&(r=this._getOrReturnCtx(e,r),Mt(r,{code:Pt.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),t.dirty());else if("max"===o.kind)e.data.length>o.value&&(r=this._getOrReturnCtx(e,r),Mt(r,{code:Pt.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),t.dirty());else if("length"===o.kind){const n=e.data.length>o.value,i=e.data.length<o.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?Mt(r,{code:Pt.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):i&&Mt(r,{code:Pt.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),t.dirty())}else if("email"===o.kind)Xt.test(e.data)||(r=this._getOrReturnCtx(e,r),Mt(r,{validation:"email",code:Pt.invalid_string,message:o.message}),t.dirty());else if("uuid"===o.kind)Ht.test(e.data)||(r=this._getOrReturnCtx(e,r),Mt(r,{validation:"uuid",code:Pt.invalid_string,message:o.message}),t.dirty());else if("cuid"===o.kind)Jt.test(e.data)||(r=this._getOrReturnCtx(e,r),Mt(r,{validation:"cuid",code:Pt.invalid_string,message:o.message}),t.dirty());else if("url"===o.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),Mt(r,{validation:"url",code:Pt.invalid_string,message:o.message}),t.dirty()}else"regex"===o.kind?(o.regex.lastIndex=0,o.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),Mt(r,{validation:"regex",code:Pt.invalid_string,message:o.message}),t.dirty())):"trim"===o.kind?e.data=e.data.trim():"startsWith"===o.kind?e.data.startsWith(o.value)||(r=this._getOrReturnCtx(e,r),Mt(r,{code:Pt.invalid_string,validation:{startsWith:o.value},message:o.message}),t.dirty()):"endsWith"===o.kind?e.data.endsWith(o.value)||(r=this._getOrReturnCtx(e,r),Mt(r,{code:Pt.invalid_string,validation:{endsWith:o.value},message:o.message}),t.dirty()):"datetime"===o.kind?((n=o).precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}:\\d{2})|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):0===n.precision?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(r=this._getOrReturnCtx(e,r),Mt(r,{code:Pt.invalid_string,validation:"datetime",message:o.message}),t.dirty()):et.assertNever(o);var n;return{status:t.value,value:e.data}}_addCheck(e){return new Qt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Vt.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Vt.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Vt.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Vt.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...Vt.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Vt.errToObj(t)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Vt.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Vt.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Vt.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Vt.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Vt.errToObj(t)})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function er(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,o=r>n?r:n;return parseInt(e.toFixed(o).replace(".",""))%parseInt(t.toFixed(o).replace(".",""))/Math.pow(10,o)}Qt.create=e=>{var t;return new Qt({checks:[],typeName:Br.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Yt(e)})};class tr extends qt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Et.number){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.number,received:t.parsedType}),Ut}let t;const r=new Dt;for(const n of this._def.checks)"int"===n.kind?et.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Mt(t,{code:Pt.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),Mt(t,{code:Pt.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),Mt(t,{code:Pt.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==er(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),Mt(t,{code:Pt.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Mt(t,{code:Pt.not_finite,message:n.message}),r.dirty()):et.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Vt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Vt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Vt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Vt.toString(t))}setLimit(e,t,r,n){return new tr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Vt.toString(n)}]})}_addCheck(e){return new tr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Vt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Vt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Vt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Vt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Vt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Vt.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Vt.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind))}}tr.create=e=>new tr({checks:[],typeName:Br.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Yt(e)});class rr extends qt{_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==Et.bigint){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.bigint,received:t.parsedType}),Ut}return Ft(e.data)}}rr.create=e=>{var t;return new rr({typeName:Br.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Yt(e)})};class nr extends qt{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==Et.boolean){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.boolean,received:t.parsedType}),Ut}return Ft(e.data)}}nr.create=e=>new nr({typeName:Br.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Yt(e)});class or extends qt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Et.date){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.date,received:t.parsedType}),Ut}if(isNaN(e.data.getTime()))return Mt(this._getOrReturnCtx(e),{code:Pt.invalid_date}),Ut;const t=new Dt;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),Mt(r,{code:Pt.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),Mt(r,{code:Pt.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):et.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new or({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Vt.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Vt.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}or.create=e=>new or({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Br.ZodDate,...Yt(e)});class ir extends qt{_parse(e){if(this._getType(e)!==Et.symbol){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.symbol,received:t.parsedType}),Ut}return Ft(e.data)}}ir.create=e=>new ir({typeName:Br.ZodSymbol,...Yt(e)});class ar extends qt{_parse(e){if(this._getType(e)!==Et.undefined){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.undefined,received:t.parsedType}),Ut}return Ft(e.data)}}ar.create=e=>new ar({typeName:Br.ZodUndefined,...Yt(e)});class sr extends qt{_parse(e){if(this._getType(e)!==Et.null){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.null,received:t.parsedType}),Ut}return Ft(e.data)}}sr.create=e=>new sr({typeName:Br.ZodNull,...Yt(e)});class cr extends qt{constructor(){super(...arguments),this._any=!0}_parse(e){return Ft(e.data)}}cr.create=e=>new cr({typeName:Br.ZodAny,...Yt(e)});class ur extends qt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ft(e.data)}}ur.create=e=>new ur({typeName:Br.ZodUnknown,...Yt(e)});class lr extends qt{_parse(e){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.never,received:t.parsedType}),Ut}}lr.create=e=>new lr({typeName:Br.ZodNever,...Yt(e)});class pr extends qt{_parse(e){if(this._getType(e)!==Et.undefined){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.void,received:t.parsedType}),Ut}return Ft(e.data)}}pr.create=e=>new pr({typeName:Br.ZodVoid,...Yt(e)});class fr extends qt{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==Et.array)return Mt(t,{code:Pt.invalid_type,expected:Et.array,received:t.parsedType}),Ut;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(e||o)&&(Mt(t,{code:e?Pt.too_big:Pt.too_small,minimum:o?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(Mt(t,{code:Pt.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(Mt(t,{code:Pt.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all(t.data.map(((e,r)=>n.type._parseAsync(new Kt(t,e,t.path,r))))).then((e=>Dt.mergeArray(r,e)));const o=t.data.map(((e,r)=>n.type._parseSync(new Kt(t,e,t.path,r))));return Dt.mergeArray(r,o)}get element(){return this._def.type}min(e,t){return new fr({...this._def,minLength:{value:e,message:Vt.toString(t)}})}max(e,t){return new fr({...this._def,maxLength:{value:e,message:Vt.toString(t)}})}length(e,t){return new fr({...this._def,exactLength:{value:e,message:Vt.toString(t)}})}nonempty(e){return this.min(1,e)}}var dr;fr.create=(e,t)=>new fr({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Br.ZodArray,...Yt(t)}),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(dr||(dr={}));const hr=e=>t=>new mr({...e,shape:()=>({...e.shape(),...t})});function yr(e){if(e instanceof mr){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Zr.create(yr(n))}return new mr({...e._def,shape:()=>t})}return e instanceof fr?fr.create(yr(e.element)):e instanceof Zr?Zr.create(yr(e.unwrap())):e instanceof Cr?Cr.create(yr(e.unwrap())):e instanceof kr?kr.create(e.items.map((e=>yr(e)))):e}class mr extends qt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=hr(this._def),this.extend=hr(this._def)}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=et.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Et.object){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.object,received:t.parsedType}),Ut}const{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof lr&&"strip"===this._def.unknownKeys))for(const e in r.data)o.includes(e)||i.push(e);const a=[];for(const e of o){const t=n[e],o=r.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new Kt(r,o,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof lr){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)a.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)i.length>0&&(Mt(r,{code:Pt.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const n=r.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new Kt(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of a){const r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>Dt.mergeObjectSync(t,e))):Dt.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return Vt.errToObj,new mr({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,o,i,a;const s=null!==(i=null===(o=(n=this._def).errorMap)||void 0===o?void 0:o.call(n,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(a=Vt.errToObj(e).message)&&void 0!==a?a:s}:{message:s}}}:{}})}strip(){return new mr({...this._def,unknownKeys:"strip"})}passthrough(){return new mr({...this._def,unknownKeys:"passthrough"})}setKey(e,t){return this.augment({[e]:t})}merge(e){return new mr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>dr.mergeShapes(this._def.shape(),e._def.shape()),typeName:Br.ZodObject})}catchall(e){return new mr({...this._def,catchall:e})}pick(e){const t={};return et.objectKeys(e).map((e=>{this.shape[e]&&(t[e]=this.shape[e])})),new mr({...this._def,shape:()=>t})}omit(e){const t={};return et.objectKeys(this.shape).map((r=>{-1===et.objectKeys(e).indexOf(r)&&(t[r]=this.shape[r])})),new mr({...this._def,shape:()=>t})}deepPartial(){return yr(this)}partial(e){const t={};if(e)return et.objectKeys(this.shape).map((r=>{-1===et.objectKeys(e).indexOf(r)?t[r]=this.shape[r]:t[r]=this.shape[r].optional()})),new mr({...this._def,shape:()=>t});for(const e in this.shape){const r=this.shape[e];t[e]=r.optional()}return new mr({...this._def,shape:()=>t})}required(e){const t={};if(e)et.objectKeys(this.shape).map((r=>{if(-1===et.objectKeys(e).indexOf(r))t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Zr;)e=e._def.innerType;t[r]=e}}));else for(const e in this.shape){let r=this.shape[e];for(;r instanceof Zr;)r=r._def.innerType;t[e]=r}return new mr({...this._def,shape:()=>t})}keyof(){return Nr(et.objectKeys(this.shape))}}mr.create=(e,t)=>new mr({shape:()=>e,unknownKeys:"strip",catchall:lr.create(),typeName:Br.ZodObject,...Yt(t)}),mr.strictCreate=(e,t)=>new mr({shape:()=>e,unknownKeys:"strict",catchall:lr.create(),typeName:Br.ZodObject,...Yt(t)}),mr.lazycreate=(e,t)=>new mr({shape:e,unknownKeys:"strip",catchall:lr.create(),typeName:Br.ZodObject,...Yt(t)});class vr extends qt{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new Lt(e.ctx.common.issues)));return Mt(t,{code:Pt.invalid_union,unionErrors:r}),Ut}));{let e;const n=[];for(const o of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=o._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const o=n.map((e=>new Lt(e)));return Mt(t,{code:Pt.invalid_union,unionErrors:o}),Ut}}get options(){return this._def.options}}vr.create=(e,t)=>new vr({options:e,typeName:Br.ZodUnion,...Yt(t)});const gr=e=>e instanceof Tr?gr(e.schema):e instanceof Ir?gr(e.innerType()):e instanceof Er?[e.value]:e instanceof Pr?e.options:e instanceof Lr?Object.keys(e.enum):e instanceof Mr?gr(e._def.innerType):e instanceof ar?[void 0]:e instanceof sr?[null]:null;class br extends qt{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Et.object)return Mt(t,{code:Pt.invalid_type,expected:Et.object,received:t.parsedType}),Ut;const r=this.discriminator,n=t.data[r],o=this.optionsMap.get(n);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(Mt(t,{code:Pt.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Ut)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const r of t){const t=gr(r.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of t){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,r)}}return new br({typeName:Br.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...Yt(r)})}}function xr(e,t){const r=Nt(e),n=Nt(t);if(e===t)return{valid:!0,data:e};if(r===Et.object&&n===Et.object){const r=et.objectKeys(t),n=et.objectKeys(e).filter((e=>-1!==r.indexOf(e))),o={...e,...t};for(const r of n){const n=xr(e[r],t[r]);if(!n.valid)return{valid:!1};o[r]=n.data}return{valid:!0,data:o}}if(r===Et.array&&n===Et.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let n=0;n<e.length;n++){const o=xr(e[n],t[n]);if(!o.valid)return{valid:!1};r.push(o.data)}return{valid:!0,data:r}}return r===Et.date&&n===Et.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class wr extends qt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(zt(e)||zt(n))return Ut;const o=xr(e.value,n.value);return o.valid?((Gt(e)||Gt(n))&&t.dirty(),{status:t.value,value:o.data}):(Mt(r,{code:Pt.invalid_intersection_types}),Ut)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}wr.create=(e,t,r)=>new wr({left:e,right:t,typeName:Br.ZodIntersection,...Yt(r)});class kr extends qt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Et.array)return Mt(r,{code:Pt.invalid_type,expected:Et.array,received:r.parsedType}),Ut;if(r.data.length<this._def.items.length)return Mt(r,{code:Pt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ut;!this._def.rest&&r.data.length>this._def.items.length&&(Mt(r,{code:Pt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=r.data.map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new Kt(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(n).then((e=>Dt.mergeArray(t,e))):Dt.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new kr({...this._def,rest:e})}}kr.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new kr({items:e,typeName:Br.ZodTuple,rest:null,...Yt(t)})};class _r extends qt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Et.object)return Mt(r,{code:Pt.invalid_type,expected:Et.object,received:r.parsedType}),Ut;const n=[],o=this._def.keyType,i=this._def.valueType;for(const e in r.data)n.push({key:o._parse(new Kt(r,e,r.path,e)),value:i._parse(new Kt(r,r.data[e],r.path,e))});return r.common.async?Dt.mergeObjectAsync(t,n):Dt.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new _r(t instanceof qt?{keyType:e,valueType:t,typeName:Br.ZodRecord,...Yt(r)}:{keyType:Qt.create(),valueType:e,typeName:Br.ZodRecord,...Yt(t)})}}class Sr extends qt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Et.map)return Mt(r,{code:Pt.invalid_type,expected:Et.map,received:r.parsedType}),Ut;const n=this._def.keyType,o=this._def.valueType,i=[...r.data.entries()].map((([e,t],i)=>({key:n._parse(new Kt(r,e,r.path,[i,"key"])),value:o._parse(new Kt(r,t,r.path,[i,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of i){const n=await r.key,o=await r.value;if("aborted"===n.status||"aborted"===o.status)return Ut;"dirty"!==n.status&&"dirty"!==o.status||t.dirty(),e.set(n.value,o.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of i){const n=r.key,o=r.value;if("aborted"===n.status||"aborted"===o.status)return Ut;"dirty"!==n.status&&"dirty"!==o.status||t.dirty(),e.set(n.value,o.value)}return{status:t.value,value:e}}}}Sr.create=(e,t,r)=>new Sr({valueType:t,keyType:e,typeName:Br.ZodMap,...Yt(r)});class Or extends qt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Et.set)return Mt(r,{code:Pt.invalid_type,expected:Et.set,received:r.parsedType}),Ut;const n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(Mt(r,{code:Pt.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(Mt(r,{code:Pt.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const o=this._def.valueType;function i(e){const r=new Set;for(const n of e){if("aborted"===n.status)return Ut;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}const a=[...r.data.values()].map(((e,t)=>o._parse(new Kt(r,e,r.path,t))));return r.common.async?Promise.all(a).then((e=>i(e))):i(a)}min(e,t){return new Or({...this._def,minSize:{value:e,message:Vt.toString(t)}})}max(e,t){return new Or({...this._def,maxSize:{value:e,message:Vt.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Or.create=(e,t)=>new Or({valueType:e,minSize:null,maxSize:null,typeName:Br.ZodSet,...Yt(t)});class jr extends qt{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Et.function)return Mt(t,{code:Pt.invalid_type,expected:Et.function,received:t.parsedType}),Ut;function r(e,r){return Ct({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Zt(),At].filter((e=>!!e)),issueData:{code:Pt.invalid_arguments,argumentsError:r}})}function n(e,r){return Ct({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Zt(),At].filter((e=>!!e)),issueData:{code:Pt.invalid_return_type,returnTypeError:r}})}const o={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof Ar?Ft((async(...e)=>{const t=new Lt([]),a=await this._def.args.parseAsync(e,o).catch((n=>{throw t.addIssue(r(e,n)),t})),s=await i(...a);return await this._def.returns._def.type.parseAsync(s,o).catch((e=>{throw t.addIssue(n(s,e)),t}))})):Ft(((...e)=>{const t=this._def.args.safeParse(e,o);if(!t.success)throw new Lt([r(e,t.error)]);const a=i(...t.data),s=this._def.returns.safeParse(a,o);if(!s.success)throw new Lt([n(a,s.error)]);return s.data}))}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new jr({...this._def,args:kr.create(e).rest(ur.create())})}returns(e){return new jr({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new jr({args:e||kr.create([]).rest(ur.create()),returns:t||ur.create(),typeName:Br.ZodFunction,...Yt(r)})}}class Tr extends qt{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Tr.create=(e,t)=>new Tr({getter:e,typeName:Br.ZodLazy,...Yt(t)});class Er extends qt{_parse(e){return e.data!==this._def.value?(Mt(this._getOrReturnCtx(e),{code:Pt.invalid_literal,expected:this._def.value}),Ut):{status:"valid",value:e.data}}get value(){return this._def.value}}function Nr(e,t){return new Pr({values:e,typeName:Br.ZodEnum,...Yt(t)})}Er.create=(e,t)=>new Er({value:e,typeName:Br.ZodLiteral,...Yt(t)});class Pr extends qt{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return Mt(t,{expected:et.joinValues(r),received:t.parsedType,code:Pt.invalid_type}),Ut}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return Mt(t,{received:t.data,code:Pt.invalid_enum_value,options:r}),Ut}return Ft(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}}Pr.create=Nr;class Lr extends qt{_parse(e){const t=et.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Et.string&&r.parsedType!==Et.number){const e=et.objectValues(t);return Mt(r,{expected:et.joinValues(e),received:r.parsedType,code:Pt.invalid_type}),Ut}if(-1===t.indexOf(e.data)){const e=et.objectValues(t);return Mt(r,{received:r.data,code:Pt.invalid_enum_value,options:e}),Ut}return Ft(e.data)}get enum(){return this._def.values}}Lr.create=(e,t)=>new Lr({values:e,typeName:Br.ZodNativeEnum,...Yt(t)});class Ar extends qt{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Et.promise&&!1===t.common.async)return Mt(t,{code:Pt.invalid_type,expected:Et.promise,received:t.parsedType}),Ut;const r=t.parsedType===Et.promise?t.data:Promise.resolve(t.data);return Ft(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Ar.create=(e,t)=>new Ar({type:e,typeName:Br.ZodPromise,...Yt(t)});class Ir extends qt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Br.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null;if("preprocess"===n.type){const e=n.transform(r.data);return r.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r}))):this._def.schema._parseSync({data:e,path:r.path,parent:r})}const o={addIssue:e=>{Mt(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(o.addIssue=o.addIssue.bind(o),"refinement"===n.type){const e=e=>{const t=n.refinement(e,o);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?Ut:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?Ut:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$t(e))return e;const i=n.transform(e.value,o);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>$t(e)?Promise.resolve(n.transform(e.value,o)).then((e=>({status:t.value,value:e}))):e))}et.assertNever(n)}}Ir.create=(e,t,r)=>new Ir({schema:e,typeName:Br.ZodEffects,effect:t,...Yt(r)}),Ir.createWithPreprocess=(e,t,r)=>new Ir({schema:t,effect:{type:"preprocess",transform:e},typeName:Br.ZodEffects,...Yt(r)});class Zr extends qt{_parse(e){return this._getType(e)===Et.undefined?Ft(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Zr.create=(e,t)=>new Zr({innerType:e,typeName:Br.ZodOptional,...Yt(t)});class Cr extends qt{_parse(e){return this._getType(e)===Et.null?Ft(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Cr.create=(e,t)=>new Cr({innerType:e,typeName:Br.ZodNullable,...Yt(t)});class Mr extends qt{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Et.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Mr.create=(e,t)=>new Mr({innerType:e,typeName:Br.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Yt(t)});class Dr extends qt{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.innerType._parse({data:t.data,path:t.path,parent:t});return Bt(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.defaultValue()}))):{status:"valid",value:"valid"===r.status?r.value:this._def.defaultValue()}}removeDefault(){return this._def.innerType}}Dr.create=(e,t)=>new Dr({innerType:e,typeName:Br.ZodCatch,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Yt(t)});class Ur extends qt{_parse(e){if(this._getType(e)!==Et.nan){const t=this._getOrReturnCtx(e);return Mt(t,{code:Pt.invalid_type,expected:Et.nan,received:t.parsedType}),Ut}return{status:"valid",value:e.data}}}Ur.create=e=>new Ur({typeName:Br.ZodNaN,...Yt(e)});const Rr=Symbol("zod_brand");class Fr extends qt{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class zr extends qt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Ut:"dirty"===e.status?(t.dirty(),Rt(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Ut:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new zr({in:e,out:t,typeName:Br.ZodPipeline})}}const Gr=(e,t={},r)=>e?cr.create().superRefine(((n,o)=>{if(!e(n)){const e="function"==typeof t?t(n):t,i="string"==typeof e?{message:e}:e;o.addIssue({code:"custom",...i,fatal:r})}})):cr.create(),$r={object:mr.lazycreate};var Br;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"}(Br||(Br={}));const Vr=Qt.create,Kr=tr.create,Wr=Ur.create,Yr=rr.create,qr=nr.create,Jr=or.create,Hr=ir.create,Xr=ar.create,Qr=sr.create,en=cr.create,tn=ur.create,rn=lr.create,nn=pr.create,on=fr.create,an=mr.create,sn=mr.strictCreate,cn=vr.create,un=br.create,ln=wr.create,pn=kr.create,fn=_r.create,dn=Sr.create,hn=Or.create,yn=jr.create,mn=Tr.create,vn=Er.create,gn=Pr.create,bn=Lr.create,xn=Ar.create,wn=Ir.create,kn=Zr.create,_n=Cr.create,Sn=Ir.createWithPreprocess,On=zr.create,jn={string:e=>Qt.create({...e,coerce:!0}),number:e=>tr.create({...e,coerce:!0}),boolean:e=>nr.create({...e,coerce:!0}),bigint:e=>rr.create({...e,coerce:!0}),date:e=>or.create({...e,coerce:!0})},Tn=Ut;var En=Object.freeze({__proto__:null,defaultErrorMap:At,setErrorMap:function(e){It=e},getErrorMap:Zt,makeIssue:Ct,EMPTY_PATH:[],addIssueToContext:Mt,ParseStatus:Dt,INVALID:Ut,DIRTY:Rt,OK:Ft,isAborted:zt,isDirty:Gt,isValid:$t,isAsync:Bt,get util(){return et},ZodParsedType:Et,getParsedType:Nt,ZodType:qt,ZodString:Qt,ZodNumber:tr,ZodBigInt:rr,ZodBoolean:nr,ZodDate:or,ZodSymbol:ir,ZodUndefined:ar,ZodNull:sr,ZodAny:cr,ZodUnknown:ur,ZodNever:lr,ZodVoid:pr,ZodArray:fr,get objectUtil(){return dr},ZodObject:mr,ZodUnion:vr,ZodDiscriminatedUnion:br,ZodIntersection:wr,ZodTuple:kr,ZodRecord:_r,ZodMap:Sr,ZodSet:Or,ZodFunction:jr,ZodLazy:Tr,ZodLiteral:Er,ZodEnum:Pr,ZodNativeEnum:Lr,ZodPromise:Ar,ZodEffects:Ir,ZodTransformer:Ir,ZodOptional:Zr,ZodNullable:Cr,ZodDefault:Mr,ZodCatch:Dr,ZodNaN:Ur,BRAND:Rr,ZodBranded:Fr,ZodPipeline:zr,custom:Gr,Schema:qt,ZodSchema:qt,late:$r,get ZodFirstPartyTypeKind(){return Br},coerce:jn,any:en,array:on,bigint:Yr,boolean:qr,date:Jr,discriminatedUnion:un,effect:wn,enum:gn,function:yn,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Gr((t=>t instanceof e),t,!0),intersection:ln,lazy:mn,literal:vn,map:dn,nan:Wr,nativeEnum:bn,never:rn,null:Qr,nullable:_n,number:Kr,object:an,oboolean:()=>qr().optional(),onumber:()=>Kr().optional(),optional:kn,ostring:()=>Vr().optional(),pipeline:On,preprocess:Sn,promise:xn,record:fn,set:hn,strictObject:sn,string:Vr,symbol:Hr,transformer:wn,tuple:pn,undefined:Xr,union:cn,unknown:tn,void:nn,NEVER:Tn,ZodIssueCode:Pt,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Lt}),Nn=En.object({id:En.string(),secret:En.boolean().optional()}),Pn=En.intersection(Nn,En.object({folderId:En.string().optional()})),Ln=En.union([En.literal("SOLID"),En.literal("DASHED"),En.literal("DOTTED")],{}),An=En.union([En.literal("POINT"),En.literal("OPEN"),En.literal("CROSS")],{}),In=En.union([En.literal("NONE"),En.literal("X"),En.literal("Y"),En.literal("XY"),En.literal("AUTO")],{}),Zn=En.union([En.literal("SMALL"),En.literal("MEDIUM"),En.literal("LARGE"),En.string()],{}),Cn=En.union([En.literal("default"),En.literal("center"),En.literal("center_auto"),En.literal("auto_center"),En.literal("above"),En.literal("above_left"),En.literal("above_right"),En.literal("above_auto"),En.literal("below"),En.literal("below_left"),En.literal("below_right"),En.literal("below_auto"),En.literal("left"),En.literal("auto_left"),En.literal("right"),En.literal("auto_right")],{}),Mn=En.object({min:En.string(),max:En.string()}),Dn=En.object({enabled:En.boolean().optional(),description:En.string().optional(),latex:En.string().optional()}),Un=En.object({type:En.literal("expression"),showLabel:En.boolean().optional(),fill:En.boolean().optional(),fillOpacity:En.string().optional(),label:En.string().optional(),labelSize:Zn.optional(),labelOrientation:Cn.optional(),labelAngle:En.string().optional(),suppressTextOutline:En.boolean().optional(),interactiveLabel:En.boolean().optional(),editableLabelMode:En.union([En.literal("MATH"),En.literal("TEXT")]).optional(),residualVariable:En.string().optional(),regressionParameters:En.record(En.string(),En.number()).optional(),isLogModeRegression:En.boolean().optional(),displayEvaluationAsFraction:En.boolean().optional(),slider:En.object({hardMin:En.boolean().optional(),hardMax:En.boolean().optional(),animationPeriod:En.number().optional(),loopMode:En.union([En.literal("LOOP_FORWARD_REVERSE"),En.literal("LOOP_FORWARD"),En.literal("PLAY_ONCE"),En.literal("PLAY_INDEFINITELY")]).optional(),playDirection:En.union([En.literal(-1),En.literal(1)]).optional(),isPlaying:En.boolean().optional(),min:En.string().optional(),max:En.string().optional(),step:En.string().optional()}).optional(),polarDomain:Mn.optional(),parametricDomain:Mn.optional(),domain:Mn.optional(),cdf:En.object({show:En.boolean(),min:En.string().optional(),max:En.string().optional()}).optional(),vizProps:En.object({breadth:En.string().optional(),axisOffset:En.string().optional(),alignedAxis:En.union([En.literal("x"),En.literal("y")]).optional(),showBoxplotOutliers:En.boolean().optional(),dotplotXMode:En.union([En.literal("exact"),En.literal("binned")]).optional(),binAlignment:En.union([En.literal("left"),En.literal("center")]).optional(),histogramMode:En.union([En.literal("count"),En.literal("relative"),En.literal("density")]).optional()}).optional(),clickableInfo:Dn.optional()}),Rn=En.object({color:En.string(),latex:En.string().optional(),hidden:En.boolean().optional(),points:En.boolean().optional(),lines:En.boolean().optional(),dragMode:In.optional(),lineStyle:Ln.optional(),pointStyle:An.optional(),colorLatex:En.string().optional(),lineOpacity:En.string().optional(),lineWidth:En.string().optional(),pointSize:En.string().optional(),pointOpacity:En.string().optional()}),Fn=Un.merge(Rn),zn=En.object({type:En.literal("image"),image_url:En.string(),name:En.string().optional(),width:En.string().optional(),height:En.string().optional(),hidden:En.boolean().optional(),center:En.string().optional(),angle:En.string().optional(),opacity:En.string().optional(),foreground:En.boolean().optional(),draggable:En.boolean().optional(),clickableInfo:En.intersection(Dn,En.object({hoveredImage:En.string().optional(),depressedImage:En.string().optional()}))}),Gn=En.intersection(En.object({id:En.string(),values:En.array(En.string())}),Rn),$n=En.intersection(Pn,En.object({type:En.literal("table"),columns:En.array(Gn)})),Bn=En.intersection(Nn,En.object({type:En.literal("folder"),hidden:En.boolean().optional(),collapsed:En.boolean().optional(),title:En.string().optional()})),Vn=En.intersection(Pn,En.object({type:En.literal("text"),text:En.string().optional()})),Kn=En.union([En.literal("NONE"),En.literal("POSITIVE"),En.literal("BOTH")],{}),Wn=En.object({viewport:En.object({xmin:En.number(),ymin:En.number(),xmax:En.number(),ymax:En.number()}).strict(),xAxisMinorSubdivisions:En.number().optional(),yAxisMinorSubdivisions:En.number().optional(),degreeMode:En.boolean().optional(),showGrid:En.boolean().optional(),showXAxis:En.boolean().optional(),showYAxis:En.boolean().optional(),xAxisNumbers:En.boolean().optional(),yAxisNumbers:En.boolean().optional(),polarNumbers:En.boolean().optional(),xAxisStep:En.number().optional(),yAxisStep:En.number().optional(),xAxisArrowMode:Kn.optional(),yAxisArrowMode:Kn.optional(),xAxisLabel:En.string().optional(),yAxisLabel:En.string().optional(),squareAxes:En.boolean().optional(),restrictGridToFirstQuadrant:En.boolean().optional(),polarMode:En.boolean().optional(),userLockedViewport:En.boolean().optional()}).strict(),Yn=En.union([Fn,zn,$n,Vn]),qn=En.object({handlerLatex:En.string().optional(),minStepLatex:En.string().optional(),open:En.boolean().optional(),playing:En.boolean().optional()}),Jn=En.union([Yn,Bn],{});function Hn(e){return Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hn(e)}function Xn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xn(Object(r),!0).forEach((function(t){eo(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function eo(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Hn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Hn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Hn(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function to(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||no(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ro(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=no(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function no(e,t){if(e){if("string"==typeof e)return oo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?oo(e,t):void 0}}function oo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function io(e){return e.length<=1?e:"".concat(e[0],"_{").concat(e.slice(1),"}")}function ao(e,t,r){var n=he(r.units.get(r.currentUnit),t,e,{compilationUnits:r.units});if("found"!=n.result){if("point-member-access"==n.result)return"".concat(ao(e.slice(0,-1),t,r),".").concat(e[e.length-1]);throw i(),o(t),s("TODO"+e.join("."))}var a=de(t).reverse();if("function"==n.identifier.type)a.splice(0,0,wt(r,n.identifier.node,"fndef").name);else if("variable"==n.identifier.type)a.splice(0,0,wt(r,n.identifier.node,"assignment").lhs);else if("builtin-function"==n.identifier.type){if(n.identifier.definedByDesmos)return"\\operatorname{".concat(e[e.length-1],"}");a.splice(0,0,e[e.length-1])}else if("builtin-variable"==n.identifier.type){if(n.identifier.definedByDesmos)return e[e.length-1];a.splice(0,0,e[e.length-1])}a.push(r.currentUnit.split("/").reverse()[0].replace(".desmo",""));var c=r.identifierNames.get(n.identifier.id);if(c)return io(c);var u,l,p="",f=function(){r.existingNames.add(p),r.identifierNames.set(n.identifier.id,p)},d=ro(a);try{for(d.s();!(u=d.n()).done;){var h=u.value;if(p=(l=h)[0].toUpperCase()+l.slice(1)+p,!r.existingNames.has(p))return f(),io(p)}}catch(e){d.e(e)}finally{d.f()}for(var y=p,m=2;;){if(p=y+m,!r.existingNames.has(p))return f(),io(p);m++}}function so(e,t){var r=function(e){return so(e,t)};switch(e.type){case"binop":var n=r(e.lhs),o=r(e.rhs);switch(e.op){case"+":case"-":case"*":return"\\left(".concat(n).concat(e.op).concat(o,"\\right)");case"/":return"\\frac{".concat(n,"}{").concat(o,"}");case"^":return"".concat(n,"^{").concat(o,"}");case"%":return"\\operatorname{mod}\\left(".concat(n,",").concat(o,"\\right)");case"<":case">":case"==":return"".concat(n).concat(e.op).concat(o);case">=":return"".concat(n,"\\ge ").concat(o);case"<=":return"".concat(n,"\\le ").concat(o);case"[":return"\\left(".concat(n,"\\right)\\left[").concat(o,"\\right]");default:throw s("UNIMPLEMENTED BINARY OP: ".concat(e.op))}case"block":var i=e.body[e.body.length-1];if(!i)throw s("NO EMPTY BLOCKS IN CODEGEN!");var a=x(i);if(!a.success)throw s("EMPTY BLOCKS MUST END IN EXPRESSIONS IN CODEGEN");return t.alreadyGeneratedBlockFinalExpressionIDs.add(i.id),r(a.data);case"error":return"ERROR";case"fncall":return"".concat(r(e.name),"\\left(").concat(e.params.map((function(e){return r(e)})).join(","),"\\right)");case"identifier":return ao(e.segments,e.enclosingScope,t);case"list":return"\\left[".concat(e.elements.map((function(e){return r(e)})).join(","),"\\right]");case"listcomp":return"\\left[".concat(r(e.body)," \\operatorname{for} ").concat(e.params.map((function(n){var o=to(n,2),i=o[0],a=o[1];return"".concat(ao([i],e.innerScope,t),"=").concat(r(a))})).join(","),"\\right]");case"macrocall":var c=e.result;if(!c||c instanceof Promise)throw s("UNRESOLVED MACRO");var u=x(c);return u.success&&"note"!=u.data.type?r(u.data):"ERROR";case"match":return"\\left\\{".concat(e.branches.map((function(e){var t=to(e,2),n=t[0],o=t[1];return"".concat(r(n),":").concat(r(o))})).join(",")).concat(e.fallback?",".concat(r(e.fallback)):"","\\right\\}");case"note":throw s("NO NOTES IN CODEGEN");case"number":return e.number.toString();case"point":return"\\left(".concat(r(e.x),",").concat(r(e.y),"\\right)");case"range":return e.step?"\\left[".concat(r(e.lhs),",").concat(r(e.step),"...").concat(r(e.rhs),"\\right]"):"\\left[".concat(r(e.lhs),"...").concat(r(e.rhs),"\\right]");case"unop":if("!"==e.op)throw s("UNIMPLEMENTED UNARY OP: !");if(".x"==e.op||".y"==e.op)return"\\left(".concat(r(e.operand),"\\right)").concat(e.op);if("-"==e.op)return"-\\left(".concat(r(e.operand),"\\right)")}throw s("UNREACHABLE")}function co(e,t){switch(e.type){case"number":return e.number;case"note":return e.content;case"json-array":return e.elements.map((function(e){return co(e,t)}));case"json-boolean":return e.data;case"json-object":return Object.fromEntries(e.data.map((function(e){var r=to(e,2);return[r[0],co(r[1],t)]})));case"json-null":return null;case"json-inner-expr":return so(e.expr,t);case"error":throw s("ERROR NODE IN JSON")}}function uo(e,t){var r=e.astNodes.get(t);if(!r)throw s("expected a node to exist");if("json-array"==r.type)return r;if("json-boolean"==r.type)return r;if("json-object"==r.type)return r;if("number"==r.type)return r;if("note"==r.type)return r;if("json-inner-expr"==r.type)return r;if("json-null"==r.type)return r;throw s("expected a json expression")}function lo(e,t){void 0!==e.options.allInOneFolderID&&(e.folderState={id:e.options.allInOneFolderID,name:""});var r,n=function(t){return t?(r=uo(e,t),(n=Fn.partial().safeParse(co(r,e))).success?n.data:(e.errors.push({type:"bad-json",node:r,start:r.start,end:r.end,unit:e.currentUnit,reason:""}),{})):{};var r,n},o=function(t){var r;e.options.annotateExpressionsWithEquivalentDesmoscript&&e.state.expressions.list.push({id:b().toString(),type:"text",text:ee(t,{indent:2,tabSize:2,maxlen:80,bindingPower:0}),folderId:null===(r=e.folderState)||void 0===r?void 0:r.id})},i=ro(t.imports);try{for(i.s();!(r=i.n()).done;){var a=r.value;po(Qn(Qn({},e),{},{currentUnit:a.compilationUnitPath}))}}catch(e){i.e(e)}finally{i.f()}var s,c=ro(t.elements.entries());try{var u=function(){var r,i,a,c,u,l=to(s.value,2),p=l[0],f=l[1];switch(f.type){case"variable":var d=wt(e,f.node,"assignment");o(d),e.state.expressions.list.push(Qn({id:b().toString(),type:"expression",color:"black",latex:"".concat(ao([p],t,e),"=").concat(so(d.rhs,e)),folderId:null===(r=e.folderState)||void 0===r?void 0:r.id},n(f.display)));break;case"function":var h=wt(e,f.node,"fndef");o(h),e.state.expressions.list.push(Qn({latex:"".concat(ao([p],t,e),"\\left(").concat(h.params.map((function(t){return ao([t],h.innerScope,e)})),"\\right)=").concat(so(h.body,e)),id:b().toString(),type:"expression",color:"black",folderId:null===(i=e.folderState)||void 0===i?void 0:i.id},n(f.display)));break;case"scope":if(0==f.scope.elements.size)break;var y=e.folderState,m={id:b().toString(),name:(null!==(a=null==y?void 0:y.name)&&void 0!==a?a:"")+(y?"/".concat(f.scope.name):"".concat(f.scope.name))};e.folderState=m,void 0===e.options.allInOneFolderID&&e.folderState&&e.state.expressions.list.push({id:e.folderState.id,title:e.folderState.name,type:"folder"}),lo(e,f.scope),e.folderState=y;break;case"note":e.state.expressions.list.push({type:"text",text:f.text,id:b().toString(),folderId:null===(c=e.folderState)||void 0===c?void 0:c.id});break;case"import":po(Qn(Qn({},e),{},{currentUnit:f.compilationUnitPath}));break;case"settings":var v=co(uo(e,f.settings),e);switch(f.settingsType){case"settings":var g=Wn.safeParse(v);if(!g.success)throw Oe(v,e.currentUnit,"failed to set settings for the following reasons: "+g.error.format()._errors.join("\n"));e.state.graph=g.data;case"ticker":var x=qn.safeParse(v);if(!x.success)throw Oe(v,e.currentUnit,"failed to set ticker for the following reasons: "+x.error.format()._errors.join("\n"));e.state.expressions.ticker=x.data}break;case"expression":var w=kt(e,f.expr);if(o(w),e.alreadyGeneratedBlockFinalExpressionIDs.has(w.id))break;e.state.expressions.list.push(Qn({type:"expression",id:b().toString(),folderId:null===(u=e.folderState)||void 0===u?void 0:u.id,latex:so(w,e),color:"black"},n(f.display)))}};for(c.s();!(s=c.n()).done;)u()}catch(e){c.e(e)}finally{c.f()}}function po(e){e.alreadyCompiledUnits.has(e.currentUnit)||(e.alreadyCompiledUnits.add(e.currentUnit),lo(e,c(e.units.get(e.currentUnit),"".concat(e.currentUnit," not found in generateCodeForCompilationUnit")).scopeTree))}function fo(e){return fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fo(e)}function ho(){ho=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new O(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function d(){}function h(){}var y={};c(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==t&&r.call(v,i)&&(y=v);var g=h.prototype=f.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(n,i,a,s){var c=l(e[n],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==fo(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function yo(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function mo(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){yo(i,n,o,a,s,"next",e)}function s(e){yo(i,n,o,a,s,"throw",e)}a(void 0)}))}}function vo(e,t,r,n){return go.apply(this,arguments)}function go(){return go=mo(ho().mark((function e(t,r,n,o){var i,s,c,u,l,p,f;return ho().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.io.resolvePath(o.io.dirname(r),t),!o.imports.has(i)){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,o.getFile(i);case 6:return c=e.sent,o.watchFiles.add(i),o.sourceCode.set(i,{src:c,linesAndCols:ii(c)}),u=[],l=o.lexAndParse(i,c,o.errors,u),null===(s=o.highlightsMap)||void 0===s||s.set(i,u),o.imports.set(i,{name:i,src:c,ast:l}),e.next=15,_(l,void 0,function(){var e=mo(ho().mark((function e(t){var n,a;return ho().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("import"!=t.type){e.next=5;break}return e.next=3,vo(t.src,i,t,o);case 3:e.next=13;break;case 5:if("import-script"!=t.type){e.next=13;break}if(o.importScripts.has(t.src)){e.next=13;break}return n=o.io.resolvePath(o.io.dirname(r),t.src),e.next=10,o.getFile(n);case 10:a=e.sent,o.watchFiles.add(a);try{new Function("desmo",a)((function(e){o.importScripts.set(n,{run:e})}))}catch(e){o.errors.push({type:"general",start:t.start,end:t.end,unit:i,reason:"failed to load '".concat(t.src,"': ").concat(e,"'")})}case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),o.errors.push(a("failed to import '".concat(t,"' (full path: ").concat(i,")"),null!==(p=null==n?void 0:n.start)&&void 0!==p?p:0,null!==(f=null==n?void 0:n.end)&&void 0!==f?f:0,r));case 20:case"end":return e.stop()}}),e,null,[[3,17]])}))),go.apply(this,arguments)}function bo(e){return bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bo(e)}function xo(){xo=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new O(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function d(){}function h(){}var y={};c(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==t&&r.call(v,i)&&(y=v);var g=h.prototype=f.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(n,i,a,s){var c=l(e[n],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==bo(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function wo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ko(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wo(Object(r),!0).forEach((function(t){_o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==bo(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==bo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===bo(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function So(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Oo(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){So(i,n,o,a,s,"next",e)}function s(e){So(i,n,o,a,s,"throw",e)}a(void 0)}))}}function jo(e,t){var r=[],n=!1;return k(e,void 0,(function(e){if("macrocall"==e.type){var o=e.enclosingScope,i=he(t.units.get(t.unit),o,e.name.segments,{compilationUnits:t.units}),a=e;"not-found"!=i.result?"point-member-access"!=i.result?"macro"==i.identifier.type?a.result||(n=!0,a.result=i.identifier.macroOperation(a,function(e,t,r){var n,o,i=function(e){var t="_macro".concat(b());return r.sourceCode.set(t,{src:e,linesAndCols:ii(e)}),P(l(e,t,[]),t,[])};function a(e){return r.io.resolvePath(r.io.dirname(r.unit),e)}return{node:function(e){return Me(Me({},e),{},{id:b(),start:t.start,end:t.end})},parse:i,parseExpr:function(e){var n=i(e);if("error"==n.type)return n;if("block"!=n.type||0==n.body.length)throw Fe("no expression found",t,r.unit);if(n.body.length>1)throw Fe("multiple expressions found; expected only one",t,r.unit);var o=x(n.body[n.body.length-1]);if(!o.success)throw Fe("expected an expression, got a non-expression",t,r.unit);return o.data},fatalError:function(n){throw e.push(Fe(n,t,r.unit)),""},recoverableError:function(n){e.push(Fe(n,t,r.unit))},fmt:function(e,t){return ee(e,t)},readFile:function(e){var t=a(e);return r.watchFiles.add(t),r.io.readFile(t)},readStringFile:(n=Ie().mark((function e(t){var n;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a(t),r.watchFiles.add(n),e.next=4,r.io.readFile(n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){Ze(i,r,o,a,s,"next",e)}function s(e){Ze(i,r,o,a,s,"throw",e)}a(void 0)}))},function(e){return o.apply(this,arguments)})}}(t.errors,a,t))):r.push(Se(a,t.unit,"expected a macro; got a '".concat(i.identifier.type,"'")).why[0]):r.push(Se(a,t.unit,"expected a macro; got a number").why[0]):r.push(Se(a,t.unit,"the macro '".concat(e.name.segments.join("."),"' does not exist")).why[0])}})),n}function To(e,t){return Eo.apply(this,arguments)}function Eo(){return Eo=Oo(xo().mark((function e(t,r){return xo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t,void 0,function(){var e=Oo(xo().mark((function e(t,n){return xo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("macrocall"==t.type){e.next=2;break}return e.abrupt("return",t);case 2:if(t.result instanceof Promise){e.next=4;break}return e.abrupt("return",n);case 4:return e.prev=4,e.next=7,t.result;case 7:t.result=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),""!=e.t0&&(t.result={start:t.start,end:t.end,id:b(),type:"error",reason:"error during macro evaluation: "+(null===e.t0||void 0===e.t0?void 0:e.t0.toString()),unitName:r.unit});case 13:return t.result=fe(t.result,{parentNode:n,scope:t.enclosingScope},ko(ko({},r),{},{errors:r.errors,importScripts:r.importScripts,getAbsolutePath:r.getAbsolutePath})),e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t,r){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),Eo.apply(this,arguments)}function No(e){return No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},No(e)}function Po(){Po=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new O(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function d(){}function h(){}var y={};c(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==t&&r.call(v,i)&&(y=v);var g=h.prototype=f.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(n,i,a,s){var c=l(e[n],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==No(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function Lo(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ao(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function Ao(e,t){if(e){if("string"==typeof e)return Io(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Io(e,t):void 0}}function Io(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Zo(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Co(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Zo(i,n,o,a,s,"next",e)}function s(e){Zo(i,n,o,a,s,"throw",e)}a(void 0)}))}}function Mo(e,t,r,n){return P(l(t,e,r),e,r,n)}function Do(e,t,r,n,o,i,s,c){var u=s.resolvePath(s.dirname(t),e);if(r.has(u))return u;var l=o.get(u);if(!l)return n.push(a("BAD IMPORT",0,0,e)),"";r.add(u);var p={resolveImport:function(e,t){return Do(e,t,r,n,o,i,s,c)},unit:u,errors:n,importScripts:c,getAbsolutePath:function(e,t){return s.resolvePath(s.dirname(e),t)}},f=le(void 0,"",p,0,l.src.length);!function(e,t){var r,n,o,i=qe(st);try{for(i.s();!(r=i.n()).done;){var a=(n=r.value,o=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(n,o)||He(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());pe(e,a[0],{type:"builtin-function",typeSignature:a[1],id:b(),definedByDesmos:!0,unitName:""},t.errors)}}catch(e){i.e(e)}finally{i.f()}var s,c,u,l,p,f=qe(Qe);try{for(f.s();!(s=f.n()).done;)pe(e,s.value,{type:"builtin-variable",id:b(),definedByDesmos:!0,unitName:"",typeSignature:{type:"number"}},t.errors)}catch(e){f.e(e)}finally{f.f()}pe(e,"five",{type:"macro",id:b(),unitName:"",macroOperation:(c=Ye(Ke().mark((function e(t,r){return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.parseExpr("1 + 696969   42042042 + 1 + 1"));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)})},t.errors),pe(e,"loadcsv",{type:"macro",id:b(),unitName:"",macroOperation:(u=Ye(Ke().mark((function e(t,r){var n,o;return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params[0],1!=t.params.length&&r.fatalError("expected exactly 1 parameter representing the csv file name"),"note"!=n.type&&r.fatalError("expected a string"),e.next=5,r.readStringFile(n.content);case 5:return o=e.sent,e.abrupt("return",r.parseExpr("[".concat(o,"]")));case 7:case"end":return e.stop()}}),e)}))),function(e,t){return u.apply(this,arguments)})},t.errors),pe(e,"loop",{type:"macro",id:b(),unitName:"",macroOperation:(l=Ye(Ke().mark((function e(t,r){var n,o,i,a,s,c,u;return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(e){return ze(e,c)},s=function(e,t){var r=function(e){return s(e,t)};return"identifier"==e.type?ze(Be(Be({},e),{},{segments:["prev"==e.segments[0]?t:e.segments[0]].concat(Je(e.segments.slice(1)))}),r):ze(e,r)},4!=t.params.length&&r.fatalError("Expected exactly 3 parameters."),n=t.params[0],o=t.params[1],"identifier"==n.type&&1==n.segments.length||r.fatalError("Expected parameter 1 to be an identifier with 1 segment."),"number"==o.type&&o.number==Math.round(o.number)||r.fatalError("Expected parameter 3 to be an integer."),i=n.segments[0],a=o.number,"block"!=t.params[2].type&&r.fatalError("expected parameter 3 to be a block"),"block"!=t.params[3].type&&r.fatalError("expected parameter 4 to be a block"),u=function(e){return-1==e?"init":"iter".concat(e)},e.abrupt("return",r.node({type:"namespace",name:i,body:r.node({type:"block",body:[r.node({type:"namespace",name:"init",body:c(t.params[2])})].concat(Je(new Array(Math.max(a-1,0)).fill(0).map((function(e,n){return r.node({type:"namespace",name:"iter".concat(n),body:s(t.params[3],u(n-1))})}))),Je(s(t.params[3],u(a-2)).body))})}));case 13:case"end":return e.stop()}}),e)}))),function(e,t){return l.apply(this,arguments)})},t.errors),pe(e,"subst",{type:"macro",id:b(),unitName:"",macroOperation:(p=Ye(Ke().mark((function e(r,n){var o,i,a,s,c,u,l;return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o=r.params).length<2&&n.fatalError("Expected at least two arguments: a macro name, zero or more macro parameters, and a macro body expression"),i=o[0],a=new Map,s=0,c=qe(o.slice(0,-1));try{for(c.s();!(u=c.n()).done;)"identifier"==(l=u.value).type&&1==l.segments.length||n.fatalError("Expected a variable name for every argument except the last."),s>0&&"identifier"==l.type&&a.set(l.segments[0],s-1),s++}catch(e){c.e(e)}finally{c.f()}return pe(r.enclosingScope,i.segments[0],{type:"macro",id:b(),unitName:"",macroOperation:function(){var e=Ye(Ke().mark((function e(t,r){var n,i,s;return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){if("identifier"==e.type&&1==e.segments.length){var t=a.get(e.segments[0]);if(void 0!==t)return ze(n[t],i)}return ze(e,i)},n=t.params,s=i(o[o.length-1]),e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},t.errors),e.abrupt("return",n.node({type:"number",number:0}));case 9:case"end":return e.stop()}}),e)}))),function(e,t){return p.apply(this,arguments)})},t.errors)}(f,p);var d=fe(l.ast,{scope:f,isValueBlock:!1},p);return i.set(u,{scopeTree:d.enclosingScope,name:u,src:l.src,linesAndCols:ii(l.src),ast:d}),u}function Uo(e,t,r,n,o,i,a,s,c){return Ro.apply(this,arguments)}function Ro(){return(Ro=Co(Po().mark((function e(t,r,n,o,i,s,c,u,l){var p,f,d,h,y,m,v;return Po().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p=0;case 1:if(!(p<100)){e.next=14;break}f=!1,d=[],h=Lo(t.values());try{for(h.s();!(y=h.n()).done;)m=y.value,v={unit:m.name,units:t,resolveImport:function(e,i){return Do(e,i,r,n,o,t,s,u)},sourceCode:i,errors:n,io:s,watchFiles:c,importScripts:u,getAbsolutePath:l},f||(f=jo(m.ast,v)),d.push(To(m.ast,v))}catch(e){h.e(e)}finally{h.f()}return e.next=8,Promise.all(d);case 8:if(f){e.next=10;break}return e.abrupt("break",14);case 10:100==p&&n.push(a("maximum macro instantiation depth exceeded",0,0,""));case 11:p++,e.next=1;break;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fo(e,t){!function(e,t){k(e,void 0,(function(e,r){t.set(e.id,e)}))}(e.ast,t)}function zo(e){var t,r=new Map,n=Lo(e.values());try{for(n.s();!(t=n.n()).done;)Fo(t.value,r)}catch(e){n.e(e)}finally{n.f()}return r}function Go(e,t){return $o.apply(this,arguments)}function $o(){return $o=Co(Po().mark((function e(t,r){var n,o,i,a,s,u,l,p,f,d,h,y,m,v;return Po().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Map,i=new Map,a=new Map,s=[],u=new Map,l=new Set,e.next=8,vo(t,t,void 0,{imports:o,sourceCode:a,lexAndParse:Mo,errors:s,getFile:function(){var e=Co(Po().mark((function e(t){var n,o;return Po().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.unsavedFiles.has(t)){e.next=3;break}return n=r.unsavedFiles.get(t),e.abrupt("return",n);case 3:return e.next=5,r.io.readFile(t);case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),io:r.io,watchFiles:r.watchFiles,importScripts:i});case 8:if(!(s.length>0)){e.next=10;break}return e.abrupt("return",{type:"error",errors:s,sourceCode:a});case 10:if(Do(t,t,l,s,o,u,r.io,i),!(s.length>0)){e.next=13;break}return e.abrupt("return",{type:"error",errors:s,sourceCode:a});case 13:return p=function(e,t){return r.io.resolvePath(r.io.dirname(e),t)},e.next=16,Uo(u,l,s,o,a,r.io,r.watchFiles,i,p);case 16:return f=zo(u),d=r.io.resolvePath(r.io.dirname(t),t),h=c(u.get(d),"".concat(d," not found in compileDesmoscript")),y=null!==(n=Tt(h.scopeTree,{units:u,unitName:d,astNodes:f,dependencyChain:new Map,knownTypes:new Map,knownCircularDependencies:new Set}))&&void 0!==n?n:{why:[]},s.push.apply(s,function(e){if(Array.isArray(e))return Io(e)}(g=y.why)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(g)||Ao(g)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),m=[],v={version:9,graph:{viewport:{xmin:-10,ymin:-10,xmax:10,ymax:10}},expressions:{list:[]}},po(b={units:u,currentUnit:r.io.resolvePath(t),identifierNames:new Map,existingNames:new Set,astNodes:f,state:v,alreadyCompiledUnits:new Set,alreadyGeneratedBlockFinalExpressionIDs:new Set,errors:m,options:r.options}),b.options.allInOneFolderID&&b.state.expressions.list.splice(0,0,{type:"folder",id:b.options.allInOneFolderID,title:"Desmoscript Compiler Output"}),e.abrupt("return",{type:"success",errors:[].concat(s,m),state:v,sourceCode:a});case 25:case"end":return e.stop()}var g,b}),e)}))),$o.apply(this,arguments)}function Bo(e){return function(e){if(Array.isArray(e))return Vo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Vo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vo(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ko(e){return Ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ko(e)}function Wo(e){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wo(e)}function Yo(){Yo=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new O(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function d(){}function h(){}var y={};c(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==t&&r.call(v,i)&&(y=v);var g=h.prototype=f.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(n,i,a,s){var c=l(e[n],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==Wo(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function qo(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Jo(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){qo(i,n,o,a,s,"next",e)}function s(e){qo(i,n,o,a,s,"throw",e)}a(void 0)}))}}function Ho(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||Qo(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xo(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qo(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function Qo(e,t){if(e){if("string"==typeof e)return ei(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ei(e,t):void 0}}function ei(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ti(e,t){var r,n=Xo(e.elements);try{for(n.s();!(r=n.n()).done;){var o=Ho(r.value,2),i=(o[0],o[1]);if("scope"==i.type&&t>=i.start&&t<=i.end)return ti(i.scope,t)}}catch(e){n.e(e)}finally{n.f()}return e}function ri(e){var t,r=new Map,n=new Set,i=[],a=function(t,r){return e.resolvePath(e.dirname(t),r)};function s(e){return u.apply(this,arguments)}function u(){return u=Jo(Yo().mark((function o(s){var u,l,p,f,d,h,y,m,v,g,b,x,w,k;return Yo().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!t){o.next=2;break}return o.abrupt("return",t);case 2:return p=new Map,f=new Map,d=new Map,h=[],y=new Map,m=new Set,v=new Map,o.next=11,vo(s,s,void 0,{imports:p,sourceCode:d,lexAndParse:Mo,errors:h,getFile:function(){var t=Jo(Yo().mark((function t(n){return Yo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.has(n)){t.next=2;break}return t.abrupt("return",r.get(n));case 2:return t.next=4,e.readFile(n);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),highlightsMap:v,io:e,watchFiles:n,importScripts:f});case 11:return Do(s,s,m,h,p,y,e,f),o.next=14,Uo(y,m,h,p,d,e,n,f,a);case 14:g=Xo(i);try{for(g.s();!(b=g.n()).done;)(0,b.value)()}catch(e){g.e(e)}finally{g.f()}return i=[],n.forEach((function(r){i.push(e.watchFile(r,(function(){t=void 0})))})),x=zo(y),w=e.resolvePath(s),k=c(y.get(w),"".concat(w," not found in compileDesmoscriptForLanguageSupport (available are ").concat(JSON.stringify(Array.from(y.keys())),") (sourcecode: ").concat(JSON.stringify(Array.from(d.keys())),")")),h.push.apply(h,function(e){if(Array.isArray(e))return ei(e)}(_=null!==(u=null===(l=Tt(k.scopeTree,{units:y,unitName:w,astNodes:x,dependencyChain:new Map,knownTypes:new Map,knownCircularDependencies:new Set}))||void 0===l?void 0:l.why)&&void 0!==u?u:[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(_)||Qo(_)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),t={errors:h,compilationUnits:y,sourceCode:d,highlightsMap:v},o.abrupt("return",t);case 24:case"end":return o.stop()}var _}),o)}))),u.apply(this,arguments)}return{updateFile:function(n,o){t=void 0,r.set(e.resolvePath(n),o)},highlightSyntax:function(t,r){return Jo(Yo().mark((function n(){var o,i,a,c,u,l,p,f;return Yo().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.resolvePath(t),n.next=3,s(t);case 3:if(o=n.sent,console.log(o),i=o.sourceCode.get(t)){n.next=8;break}return n.abrupt("return");case 8:if(a=function(e,t,n,o){if(t!=n){var i,a=Xo(e.split("\n"));try{for(a.s();!(i=a.n()).done;){var s=i.value,c=t+s.length;r(s,t,c,o),t=c+1}}catch(e){a.e(e)}finally{a.f()}}},o.highlightsMap){n.next=11;break}return n.abrupt("return");case 11:if(c=o.highlightsMap.get(t)){u=Xo(c);try{for(u.s();!(l=u.n()).done;)p=l.value,r(i.src.slice(p.start,p.end),p.start,p.end,p.type)}catch(e){u.e(e)}finally{u.f()}}if(o.compilationUnits){n.next=15;break}return n.abrupt("return");case 15:if(f=o.compilationUnits.get(t)){n.next=18;break}return n.abrupt("return");case 18:k(f.ast,void 0,(function(e){if(o.compilationUnits)if("identifier"!=e.type);else{var t=he(f,e.enclosingScope,e.segments,{compilationUnits:o.compilationUnits});if("found"!=t.result)return;a(e.segments[e.segments.length-1],e.start+e.segments.slice(0,-1).join(".").length+(e.segments.length>1?1:0),e.end,{variable:"variable",function:"function",scope:"namespace","builtin-variable":"variable","builtin-function":"function",note:"string",macro:"macro",expression:"variable",import:"namespace",settings:"variable"}[t.identifier.type])}}));case 19:case"end":return n.stop()}}),n)})))()},getDefinitions:function(t,r){return Jo(Yo().mark((function n(){var o,i;return Yo().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.resolvePath(t),n.next=3,s(t);case 3:if((o=n.sent).compilationUnits){n.next=6;break}return n.abrupt("return");case 6:if(i=o.compilationUnits.get(t)){n.next=9;break}return n.abrupt("return");case 9:k(i.ast,void 0,(function(e){if(o.compilationUnits&&"identifier"==e.type){var t=he(i,e.enclosingScope,e.segments,{compilationUnits:o.compilationUnits});if("found"!=t.result)return;if("function"!=t.identifier.type&&"variable"!=t.identifier.type)return;r(e.segments.join("."),e.start,e.end,t.identifier.start,t.identifier.end,t.identifier.unitName)}}));case 10:case"end":return n.stop()}}),n)})))()},goToDefinition:function(t,r){return Jo(Yo().mark((function n(){var o,i,a,c;return Yo().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.resolvePath(t),n.next=3,s(t);case 3:if((o=n.sent).compilationUnits){n.next=6;break}return n.abrupt("return");case 6:if(i=o.compilationUnits.get(t)){n.next=9;break}return n.abrupt("return");case 9:if(k(i.ast,void 0,(function(e){o.compilationUnits&&"identifier"==e.type&&r>=e.start&&r<=e.end&&(a=e)})),a){n.next=12;break}return n.abrupt("return");case 12:if("found"==(c=he(i,a.enclosingScope,a.segments,{compilationUnits:o.compilationUnits})).result){n.next=15;break}return n.abrupt("return");case 15:if("function"==c.identifier.type||"variable"==c.identifier.type){n.next=17;break}return n.abrupt("return");case 17:return n.abrupt("return",{start:c.identifier.start,end:c.identifier.end,unit:c.identifier.unitName});case 18:case"end":return n.stop()}}),n)})))()},getErrors:function(t,r){return Jo(Yo().mark((function n(){var o,i,a,c,u,l,p;return Yo().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.resolvePath(t),n.next=3,s(t);case 3:o=n.sent,i=Xo(o.errors);try{for(i.s();!(a=i.n()).done;)if((c=a.value).unit==t&&(r(c.start,c.end,Pe({format:function(e,t){return e},entry:t,sourceCode:o.sourceCode,maxWidth:80,hideSourceCode:!0,io:e},c)),"circular-dependency"==c.type)){u=Xo(c.path);try{for(u.s();!(l=u.n()).done;)p=l.value,r(p.start,p.end,"this is part of a circular dependency chain")}catch(e){u.e(e)}finally{u.f()}}}catch(e){i.e(e)}finally{i.f()}case 6:case"end":return n.stop()}}),n)})))()},formatFile:function(t){return Jo(Yo().mark((function r(){var n,i,a,c,u,p;return Yo().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.resolvePath(t),r.next=3,s(t);case 3:if((n=r.sent).compilationUnits){r.next=6;break}return r.abrupt("return");case 6:if(i=n.compilationUnits.get(t)){r.next=9;break}return r.abrupt("return",void 0);case 9:if(a=ee(i.ast),c=l(a,i.name,[]),u=P(c,i.name,[]),f=i.ast,p=function e(t,r){if(void 0===t)return t===r;if(Ko(t)!=Ko(r))return!1;if("number"==typeof t||"string"==typeof t||"boolean"==typeof t)return t==r;if(Array.isArray(t)){if(!Array.isArray(r))return!1;if(t.length!=r.length)return!1;for(var n=[],o=0;o<t.length;o++){var i=e(t[o],r[o]);if(!1===i)return!1;Array.isArray(i)&&n.push.apply(n,Bo(i))}return n}if("object"==Ko(t)&&"number"==typeof t.id){var a=[],s=t;if("object"!=Ko(r)||"number"!=typeof r.id)return[{nodeA:s}];for(var c=r,u=0,l=Object.keys(t);u<l.length;u++){var p=l[u];if("id"!=p&&"start"!=p&&"end"!=p&&"enclosingScope"!=p&&"innerScope"!=p&&("result"!=p||"macrocall"!=s.type)){var f=e(t[p],r[p]);if(!1===f)return[{nodeA:s,nodeB:c}];Array.isArray(f)&&a.push.apply(a,Bo(f))}}return a}return!1}(f,u),!(p.length>0)){r.next=16;break}return o("AST DIFFERENCE IN FORMATTER: ",p),r.abrupt("return");case 16:return r.abrupt("return",a);case 17:case"end":return r.stop()}var f}),r)})))()},getColors:function(t,r){return Jo(Yo().mark((function n(){var o,i;return Yo().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.resolvePath(t),n.next=3,s(t);case 3:if((o=n.sent).compilationUnits){n.next=6;break}return n.abrupt("return");case 6:if(i=o.compilationUnits.get(t)){n.next=9;break}return n.abrupt("return",void 0);case 9:k(i.ast,void 0,(function(e){var t,n,o;"fncall"==e.type&&"rgb"==e.name.segments[0]&&"number"==(null===(t=e.params[0])||void 0===t?void 0:t.type)&&"number"==(null===(n=e.params[1])||void 0===n?void 0:n.type)&&"number"==(null===(o=e.params[2])||void 0===o?void 0:o.type)&&r(e.start,e.end,[e.params[0].number,e.params[1].number,e.params[2].number])}));case 11:case"end":return n.stop()}}),n)})))()},getAutocomplete:function(t,r,n){return Jo(Yo().mark((function o(){var i,a,c,u,l,p,f,d,h,y,m,v,g,b,x,w,k;return Yo().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.resolvePath(t),o.next=3,s(t);case 3:if((i=o.sent).compilationUnits){o.next=6;break}return o.abrupt("return");case 6:if(a=i.compilationUnits.get(t)){o.next=9;break}return o.abrupt("return",void 0);case 9:for(c=ti(a.scopeTree,r),u="",l=r-1;a.src[l]&&a.src[l].match(/[a-zA-Z_0-9\.]/g);)u=a.src[l]+u,l--;for(l=r;a.src[l]&&a.src[l].match(/[a-zA-Z_0-9\.]/g);)u+=a.src[l],l++;if(p=u.split("."),f=p.slice(0,-1),d=p[p.length-1],0==f.length){o.next=27;break}if("found"==(y=he(a,c,f,{compilationUnits:i.compilationUnits})).result){o.next=22;break}return o.abrupt("return");case 22:if("scope"==y.identifier.type){o.next=24;break}return o.abrupt("return");case 24:h=y.identifier.scope,o.next=28;break;case 27:h=c;case 28:m=Xo(h.elements);try{for(m.s();!(v=m.n()).done;)if(g=Ho(v.value,2),b=g[0],x=g[1],b.startsWith(d)){switch(w=b,k="variable",x.type){case"function":case"builtin-function":k="function";case"macro":k="macro";case"scope":k="scope"}n(w,k)}}catch(e){m.e(e)}finally{m.f()}case 30:case"end":return o.stop()}}),o)})))()},onHover:function(t,r){return Jo(Yo().mark((function n(){var o,i,a;return Yo().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.resolvePath(t),n.next=3,s(t);case 3:if((o=n.sent).compilationUnits){n.next=6;break}return n.abrupt("return");case 6:if(i=o.compilationUnits.get(t)){n.next=9;break}return n.abrupt("return",void 0);case 9:if(k(i.ast,void 0,(function(e){r>=e.start&&r<=e.end&&"macrocall"==e.type&&(a=e)})),a){n.next=12;break}return n.abrupt("return");case 12:if("macrocall"!=a.type||!a.result||a.result instanceof Promise){n.next=14;break}return n.abrupt("return","Evaluates to:\n".concat(ee(a.result)));case 14:case"end":return n.stop()}}),n)})))()}}}function ni(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}En.object({version:En.literal(9),randomSeed:En.string().optional(),graph:Wn,expressions:En.object({list:En.array(Jn),ticker:En.optional(qn)})});var oi=0;function ii(e){var t,r=[],n=1,o=1,i=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ni(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ni(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r.push([n,o]),"\n"==a?(n++,o=1):o++}}catch(e){i.e(e)}finally{i.f()}return r}module.exports=t})();
//# sourceMappingURL=bundle.js.map